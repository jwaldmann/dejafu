<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Test.DejaFu.Deterministic.IO</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Test-DejaFu-Deterministic-IO.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Test-DejaFu-Deterministic-IO.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">dejafu-0.0.0.0: Overloadable primitives for testable, potentially non-deterministic, concurrency.</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Test.DejaFu.Deterministic.IO</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">The <code>ConcIO</code> Monad</a></li><li><a href="#g:2"><code>CVar</code>s</a></li><li><a href="#g:3"><code>CRef</code>s</a></li><li><a href="#g:4">Testing</a></li><li><a href="#g:5">Execution traces</a></li><li><a href="#g:6">Scheduling</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Deterministic traced execution of concurrent computations which
 may do <code>IO</code>.</p><p><strong>Caution!</strong> Blocking on the action of another thread in <code><a href="Test-DejaFu-Deterministic-IO.html#v:liftIO">liftIO</a></code>
 cannot be detected! So if you perform some potentially blocking
 action in a <code><a href="Test-DejaFu-Deterministic-IO.html#v:liftIO">liftIO</a></code> the entire collection of threads may deadlock!
 You should therefore keep <code>IO</code> blocks small, and only perform
 blocking operations with the supplied primitives, insofar as
 possible.</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">data</span> <a href="#t:ConcIO">ConcIO</a> t a</li><li class="src short"><span class="keyword">data</span> <a href="#t:Failure">Failure</a><ul class="subs"><li>= <a href="#v:InternalError">InternalError</a></li><li>| <a href="#v:Deadlock">Deadlock</a></li><li>| <a href="#v:STMDeadlock">STMDeadlock</a></li><li>| <a href="#v:UncaughtException">UncaughtException</a></li><li>| <a href="#v:FailureInNoTest">FailureInNoTest</a></li></ul></li><li class="src short"><a href="#v:runConcIO">runConcIO</a> :: <a href="Test-DejaFu-Deterministic-Schedule.html#t:Scheduler">Scheduler</a> s -&gt; s -&gt; (<span class="keyword">forall</span> t. <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a) -&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a> (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Either.html#t:Either">Either</a> <a href="Test-DejaFu-Deterministic-IO.html#t:Failure">Failure</a> a, s, <a href="Test-DejaFu-Deterministic-IO.html#t:Trace">Trace</a>)</li><li class="src short"><a href="#v:liftIO">liftIO</a> :: <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a> a -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a</li><li class="src short"><a href="#v:fork">fork</a> :: <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t () -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t <a href="Test-DejaFu-Deterministic-Schedule.html#t:ThreadId">ThreadId</a></li><li class="src short"><a href="#v:forkFinally">forkFinally</a> :: <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a -&gt; (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Either.html#t:Either">Either</a> <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Control-Exception-Base.html#t:SomeException">SomeException</a> a -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t ()) -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t <a href="Test-DejaFu-Deterministic-Schedule.html#t:ThreadId">ThreadId</a></li><li class="src short"><a href="#v:forkWithUnmask">forkWithUnmask</a> :: ((<span class="keyword">forall</span> a. <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a) -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t ()) -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t <a href="Test-DejaFu-Deterministic-Schedule.html#t:ThreadId">ThreadId</a></li><li class="src short"><a href="#v:forkOn">forkOn</a> :: <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Int.html#t:Int">Int</a> -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t () -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t <a href="Test-DejaFu-Deterministic-Schedule.html#t:ThreadId">ThreadId</a></li><li class="src short"><a href="#v:getNumCapabilities">getNumCapabilities</a> :: <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Int.html#t:Int">Int</a></li><li class="src short"><a href="#v:myThreadId">myThreadId</a> :: <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t <a href="Test-DejaFu-Deterministic-Schedule.html#t:ThreadId">ThreadId</a></li><li class="src short"><a href="#v:spawn">spawn</a> :: <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t (<a href="Test-DejaFu-Deterministic-IO.html#t:CVar">CVar</a> t a)</li><li class="src short"><a href="#v:atomically">atomically</a> :: <a href="Test-DejaFu-STM.html#t:STMLike">STMLike</a> t <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a> <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-IORef.html#t:IORef">IORef</a> a -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a</li><li class="src short"><a href="#v:throw">throw</a> :: <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Control-Exception-Base.html#t:Exception">Exception</a> e =&gt; e -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a</li><li class="src short"><a href="#v:throwTo">throwTo</a> :: <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Control-Exception-Base.html#t:Exception">Exception</a> e =&gt; <a href="Test-DejaFu-Deterministic-Schedule.html#t:ThreadId">ThreadId</a> -&gt; e -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t ()</li><li class="src short"><a href="#v:killThread">killThread</a> :: <a href="Test-DejaFu-Deterministic-Schedule.html#t:ThreadId">ThreadId</a> -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t ()</li><li class="src short"><a href="#v:catch">catch</a> :: <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Control-Exception-Base.html#t:Exception">Exception</a> e =&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a -&gt; (e -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a) -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a</li><li class="src short"><a href="#v:mask">mask</a> :: ((<span class="keyword">forall</span> a. <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a) -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t b) -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t b</li><li class="src short"><a href="#v:uninterruptibleMask">uninterruptibleMask</a> :: ((<span class="keyword">forall</span> a. <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a) -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t b) -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t b</li><li class="src short"><span class="keyword">data</span> <a href="#t:CVar">CVar</a> t a</li><li class="src short"><a href="#v:newEmptyCVar">newEmptyCVar</a> :: <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t (<a href="Test-DejaFu-Deterministic-IO.html#t:CVar">CVar</a> t a)</li><li class="src short"><a href="#v:putCVar">putCVar</a> :: <a href="Test-DejaFu-Deterministic-IO.html#t:CVar">CVar</a> t a -&gt; a -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t ()</li><li class="src short"><a href="#v:tryPutCVar">tryPutCVar</a> :: <a href="Test-DejaFu-Deterministic-IO.html#t:CVar">CVar</a> t a -&gt; a -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#t:Bool">Bool</a></li><li class="src short"><a href="#v:readCVar">readCVar</a> :: <a href="Test-DejaFu-Deterministic-IO.html#t:CVar">CVar</a> t a -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a</li><li class="src short"><a href="#v:takeCVar">takeCVar</a> :: <a href="Test-DejaFu-Deterministic-IO.html#t:CVar">CVar</a> t a -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a</li><li class="src short"><a href="#v:tryTakeCVar">tryTakeCVar</a> :: <a href="Test-DejaFu-Deterministic-IO.html#t:CVar">CVar</a> t a -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Maybe.html#t:Maybe">Maybe</a> a)</li><li class="src short"><span class="keyword">data</span> <a href="#t:CRef">CRef</a> t a</li><li class="src short"><a href="#v:newCRef">newCRef</a> :: a -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t (<a href="Test-DejaFu-Deterministic-IO.html#t:CRef">CRef</a> t a)</li><li class="src short"><a href="#v:readCRef">readCRef</a> :: <a href="Test-DejaFu-Deterministic-IO.html#t:CRef">CRef</a> t a -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a</li><li class="src short"><a href="#v:writeCRef">writeCRef</a> :: <a href="Test-DejaFu-Deterministic-IO.html#t:CRef">CRef</a> t a -&gt; a -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t ()</li><li class="src short"><a href="#v:modifyCRef">modifyCRef</a> :: <a href="Test-DejaFu-Deterministic-IO.html#t:CRef">CRef</a> t a -&gt; (a -&gt; (a, b)) -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t b</li><li class="src short"><a href="#v:_concNoTest">_concNoTest</a> :: <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a</li><li class="src short"><a href="#v:_concKnowsAbout">_concKnowsAbout</a> :: <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Either.html#t:Either">Either</a> (<a href="Test-DejaFu-Deterministic-IO.html#t:CVar">CVar</a> t a) (<a href="Test-DejaFu-STM.html#t:CTVar">CTVar</a> t <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-IORef.html#t:IORef">IORef</a> a) -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t ()</li><li class="src short"><a href="#v:_concForgets">_concForgets</a> :: <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Either.html#t:Either">Either</a> (<a href="Test-DejaFu-Deterministic-IO.html#t:CVar">CVar</a> t a) (<a href="Test-DejaFu-STM.html#t:CTVar">CTVar</a> t <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-IORef.html#t:IORef">IORef</a> a) -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t ()</li><li class="src short"><a href="#v:_concAllKnown">_concAllKnown</a> :: <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t ()</li><li class="src short"><span class="keyword">type</span> <a href="#t:Trace">Trace</a> = [(<a href="Test-DejaFu-Deterministic-IO.html#t:Decision">Decision</a>, [<a href="Test-DejaFu-Deterministic-IO.html#t:Decision">Decision</a>], <a href="Test-DejaFu-Deterministic-IO.html#t:ThreadAction">ThreadAction</a>)]</li><li class="src short"><span class="keyword">data</span> <a href="#t:Decision">Decision</a><ul class="subs"><li>= <a href="#v:Start">Start</a> <a href="Test-DejaFu-Deterministic-Schedule.html#t:ThreadId">ThreadId</a></li><li>| <a href="#v:Continue">Continue</a></li><li>| <a href="#v:SwitchTo">SwitchTo</a> <a href="Test-DejaFu-Deterministic-Schedule.html#t:ThreadId">ThreadId</a></li></ul></li><li class="src short"><span class="keyword">data</span> <a href="#t:ThreadAction">ThreadAction</a><ul class="subs"><li>= <a href="#v:Fork">Fork</a> <a href="Test-DejaFu-Deterministic-Schedule.html#t:ThreadId">ThreadId</a></li><li>| <a href="#v:MyThreadId">MyThreadId</a></li><li>| <a href="#v:New">New</a> <a href="Test-DejaFu-Deterministic-IO.html#t:CVarId">CVarId</a></li><li>| <a href="#v:Put">Put</a> <a href="Test-DejaFu-Deterministic-IO.html#t:CVarId">CVarId</a> [<a href="Test-DejaFu-Deterministic-Schedule.html#t:ThreadId">ThreadId</a>]</li><li>| <a href="#v:BlockedPut">BlockedPut</a> <a href="Test-DejaFu-Deterministic-IO.html#t:CVarId">CVarId</a></li><li>| <a href="#v:TryPut">TryPut</a> <a href="Test-DejaFu-Deterministic-IO.html#t:CVarId">CVarId</a> <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#t:Bool">Bool</a> [<a href="Test-DejaFu-Deterministic-Schedule.html#t:ThreadId">ThreadId</a>]</li><li>| <a href="#v:Read">Read</a> <a href="Test-DejaFu-Deterministic-IO.html#t:CVarId">CVarId</a></li><li>| <a href="#v:BlockedRead">BlockedRead</a> <a href="Test-DejaFu-Deterministic-IO.html#t:CVarId">CVarId</a></li><li>| <a href="#v:Take">Take</a> <a href="Test-DejaFu-Deterministic-IO.html#t:CVarId">CVarId</a> [<a href="Test-DejaFu-Deterministic-Schedule.html#t:ThreadId">ThreadId</a>]</li><li>| <a href="#v:BlockedTake">BlockedTake</a> <a href="Test-DejaFu-Deterministic-IO.html#t:CVarId">CVarId</a></li><li>| <a href="#v:TryTake">TryTake</a> <a href="Test-DejaFu-Deterministic-IO.html#t:CVarId">CVarId</a> <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#t:Bool">Bool</a> [<a href="Test-DejaFu-Deterministic-Schedule.html#t:ThreadId">ThreadId</a>]</li><li>| <a href="#v:NewRef">NewRef</a> <a href="Test-DejaFu-Deterministic.html#t:CRefId">CRefId</a></li><li>| <a href="#v:ReadRef">ReadRef</a> <a href="Test-DejaFu-Deterministic.html#t:CRefId">CRefId</a></li><li>| <a href="#v:ModRef">ModRef</a> <a href="Test-DejaFu-Deterministic.html#t:CRefId">CRefId</a></li><li>| <a href="#v:STM">STM</a> [<a href="Test-DejaFu-Deterministic-Schedule.html#t:ThreadId">ThreadId</a>]</li><li>| <a href="#v:FreshSTM">FreshSTM</a></li><li>| <a href="#v:BlockedSTM">BlockedSTM</a></li><li>| <a href="#v:Catching">Catching</a></li><li>| <a href="#v:PopCatching">PopCatching</a></li><li>| <a href="#v:Throw">Throw</a></li><li>| <a href="#v:ThrowTo">ThrowTo</a> <a href="Test-DejaFu-Deterministic-Schedule.html#t:ThreadId">ThreadId</a></li><li>| <a href="#v:BlockedThrowTo">BlockedThrowTo</a> <a href="Test-DejaFu-Deterministic-Schedule.html#t:ThreadId">ThreadId</a></li><li>| <a href="#v:Killed">Killed</a></li><li>| <a href="#v:SetMasking">SetMasking</a> <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#t:Bool">Bool</a> <a href="Test-DejaFu-Deterministic-IO.html#t:MaskingState">MaskingState</a></li><li>| <a href="#v:ResetMasking">ResetMasking</a> <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#t:Bool">Bool</a> <a href="Test-DejaFu-Deterministic-IO.html#t:MaskingState">MaskingState</a></li><li>| <a href="#v:Lift">Lift</a></li><li>| <a href="#v:NoTest">NoTest</a></li><li>| <a href="#v:KnowsAbout">KnowsAbout</a></li><li>| <a href="#v:Forgets">Forgets</a></li><li>| <a href="#v:AllKnown">AllKnown</a></li><li>| <a href="#v:Stop">Stop</a></li></ul></li><li class="src short"><span class="keyword">type</span> <a href="#t:CVarId">CVarId</a> = <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Int.html#t:Int">Int</a></li><li class="src short"><span class="keyword">data</span> <a href="#t:MaskingState">MaskingState</a> :: *<ul class="subs"><li>= <a href="#v:Unmasked">Unmasked</a></li><li>| <a href="#v:MaskedInterruptible">MaskedInterruptible</a></li><li>| <a href="#v:MaskedUninterruptible">MaskedUninterruptible</a></li></ul></li><li class="src short"><a href="#v:showTrace">showTrace</a> :: <a href="Test-DejaFu-Deterministic-IO.html#t:Trace">Trace</a> -&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-String.html#t:String">String</a></li><li class="src short">module <a href="Test-DejaFu-Deterministic-Schedule.html">Test.DejaFu.Deterministic.Schedule</a></li></ul></div><div id="interface"><h1 id="g:1">The <code>ConcIO</code> Monad</h1><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:ConcIO" class="def">ConcIO</a> t a <a href="src/Test-DejaFu-Deterministic-IO.html#ConcIO" class="link">Source</a></p><div class="doc"><p>The <code><a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a></code> variant of Test.DejaFu.Deterministic's <code>Conc</code> monad.</p></div><div class="subs instances"><p id="control.i:ConcIO" class="caption collapser" onclick="toggleSection('i:ConcIO')">Instances</p><div id="section.i:ConcIO" class="show"><table><tr><td class="src"><a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Control-Monad.html#t:Monad">Monad</a> (<a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t) <a href="src/Test-DejaFu-Deterministic-IO.html#line-85" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Functor.html#t:Functor">Functor</a> (<a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t) <a href="src/Test-DejaFu-Deterministic-IO.html#line-85" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Control-Applicative.html#t:Applicative">Applicative</a> (<a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t) <a href="src/Test-DejaFu-Deterministic-IO.html#line-85" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="https://hackage.haskell.org/package/transformers-0.4.2.0/docs/Control-Monad-IO-Class.html#t:MonadIO">MonadIO</a> (<a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t) <a href="src/Test-DejaFu-Deterministic-IO.html#line-100" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">MonadThrow (<a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t) <a href="src/Test-DejaFu-Deterministic-IO.html#line-93" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">MonadMask (<a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t) <a href="src/Test-DejaFu-Deterministic-IO.html#line-96" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">MonadCatch (<a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t) <a href="src/Test-DejaFu-Deterministic-IO.html#line-90" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="Control-Monad-Conc-Class.html#t:MonadConc">MonadConc</a> (<a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t) <a href="src/Test-DejaFu-Deterministic-IO.html#line-103" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><span class="keyword">type</span> <a href="Control-Monad-Conc-Class.html#t:STMLike">STMLike</a> (<a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t) = <a href="Test-DejaFu-STM.html#t:STMLike">STMLike</a> t <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a> <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-IORef.html#t:IORef">IORef</a> <a href="src/Test-DejaFu-Deterministic-IO.html#line-106" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><span class="keyword">type</span> <a href="Control-Monad-Conc-Class.html#t:CVar">CVar</a> (<a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t) = <a href="Test-DejaFu-Deterministic-IO.html#t:CVar">CVar</a> t <a href="src/Test-DejaFu-Deterministic-IO.html#line-104" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><span class="keyword">type</span> <a href="Control-Monad-Conc-Class.html#t:CRef">CRef</a> (<a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t) = <a href="Test-DejaFu-Deterministic-IO.html#t:CRef">CRef</a> t <a href="src/Test-DejaFu-Deterministic-IO.html#line-105" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><span class="keyword">type</span> <a href="Control-Monad-Conc-Class.html#t:ThreadId">ThreadId</a> (<a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t) = <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Int.html#t:Int">Int</a> <a href="src/Test-DejaFu-Deterministic-IO.html#line-107" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:Failure" class="def">Failure</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#Failure" class="link">Source</a></p><div class="doc"><p>An indication of how a concurrent computation failed.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:InternalError" class="def">InternalError</a></td><td class="doc"><p>Will be raised if the scheduler does something bad. This should
 never arise unless you write your own, faulty, scheduler! If it
 does, please file a bug report.</p></td></tr><tr><td class="src"><a name="v:Deadlock" class="def">Deadlock</a></td><td class="doc"><p>The computation became blocked indefinitely on <code>CVar</code>s.</p></td></tr><tr><td class="src"><a name="v:STMDeadlock" class="def">STMDeadlock</a></td><td class="doc"><p>The computation became blocked indefinitely on <code>CTVar</code>s.</p></td></tr><tr><td class="src"><a name="v:UncaughtException" class="def">UncaughtException</a></td><td class="doc"><p>An uncaught exception bubbled to the top of the computation.</p></td></tr><tr><td class="src"><a name="v:FailureInNoTest" class="def">FailureInNoTest</a></td><td class="doc"><p>A computation annotated with <code>_concNoTest</code> produced a failure,
 rather than a result.</p></td></tr></table></div><div class="subs instances"><p id="control.i:Failure" class="caption collapser" onclick="toggleSection('i:Failure')">Instances</p><div id="section.i:Failure" class="show"><table><tr><td class="src"><a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Eq.html#t:Eq">Eq</a> <a href="Test-DejaFu-Deterministic-IO.html#t:Failure">Failure</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#line-258" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Text-Show.html#t:Show">Show</a> <a href="Test-DejaFu-Deterministic-IO.html#t:Failure">Failure</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#line-258" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="https://hackage.haskell.org/package/deepseq-1.4.1.1/docs/Control-DeepSeq.html#t:NFData">NFData</a> <a href="Test-DejaFu-Deterministic-IO.html#t:Failure">Failure</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#line-260" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><a name="v:runConcIO" class="def">runConcIO</a> :: <a href="Test-DejaFu-Deterministic-Schedule.html#t:Scheduler">Scheduler</a> s -&gt; s -&gt; (<span class="keyword">forall</span> t. <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a) -&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a> (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Either.html#t:Either">Either</a> <a href="Test-DejaFu-Deterministic-IO.html#t:Failure">Failure</a> a, s, <a href="Test-DejaFu-Deterministic-IO.html#t:Trace">Trace</a>) <a href="src/Test-DejaFu-Deterministic-IO.html#runConcIO" class="link">Source</a></p><div class="doc"><p>Run a concurrent computation with a given <code><a href="Test-DejaFu-Deterministic-Schedule.html#t:Scheduler">Scheduler</a></code> and initial
 state, returning an failure reason on error. Also returned is the
 final state of the scheduler, and an execution trace.</p></div></div><div class="top"><p class="src"><a name="v:liftIO" class="def">liftIO</a> :: <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a> a -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a <a href="src/Test-DejaFu-Deterministic-IO.html#liftIO" class="link">Source</a></p><div class="doc"><p>Lift an <code><a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a></code> action into the <code><a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a></code> monad.</p></div></div><div class="top"><p class="src"><a name="v:fork" class="def">fork</a> :: <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t () -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t <a href="Test-DejaFu-Deterministic-Schedule.html#t:ThreadId">ThreadId</a> <a href="src/Test-DejaFu-Deterministic-IO.html#fork" class="link">Source</a></p><div class="doc"><p>Run the provided computation concurrently.</p></div></div><div class="top"><p class="src"><a name="v:forkFinally" class="def">forkFinally</a> :: <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a -&gt; (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Either.html#t:Either">Either</a> <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Control-Exception-Base.html#t:SomeException">SomeException</a> a -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t ()) -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t <a href="Test-DejaFu-Deterministic-Schedule.html#t:ThreadId">ThreadId</a> <a href="src/Test-DejaFu-Deterministic-IO.html#forkFinally" class="link">Source</a></p><div class="doc"><p>Fork a thread and call the supplied function when the thread is
 about to terminate, with an exception or a returned value. The
 function is called with asynchronous exceptions masked.</p><p>This function is useful for informing the parent when a child
 terminates, for example.</p></div></div><div class="top"><p class="src"><a name="v:forkWithUnmask" class="def">forkWithUnmask</a> :: ((<span class="keyword">forall</span> a. <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a) -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t ()) -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t <a href="Test-DejaFu-Deterministic-Schedule.html#t:ThreadId">ThreadId</a> <a href="src/Test-DejaFu-Deterministic-IO.html#forkWithUnmask" class="link">Source</a></p><div class="doc"><p>Like <code><a href="Test-DejaFu-Deterministic-IO.html#v:fork">fork</a></code>, but the child thread is passed a function that can
 be used to unmask asynchronous exceptions. This function should not
 be used within a <code><a href="Test-DejaFu-Deterministic-IO.html#v:mask">mask</a></code> or <code><a href="Test-DejaFu-Deterministic-IO.html#v:uninterruptibleMask">uninterruptibleMask</a></code>.</p></div></div><div class="top"><p class="src"><a name="v:forkOn" class="def">forkOn</a> :: <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Int.html#t:Int">Int</a> -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t () -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t <a href="Test-DejaFu-Deterministic-Schedule.html#t:ThreadId">ThreadId</a> <a href="src/Test-DejaFu-Deterministic-IO.html#forkOn" class="link">Source</a></p><div class="doc"><p>Fork a computation to happen on a specific processor. This
 implementation only has a single processor.</p></div></div><div class="top"><p class="src"><a name="v:getNumCapabilities" class="def">getNumCapabilities</a> :: <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Int.html#t:Int">Int</a> <a href="src/Test-DejaFu-Deterministic-IO.html#getNumCapabilities" class="link">Source</a></p><div class="doc"><p>Get the number of Haskell threads that can run
 simultaneously. This implementation lies and always returns
 2. There is no way to verify in the computation that this is a lie,
 and will potentially avoid special-case behaviour for 1 capability,
 so it seems a sane choice.</p></div></div><div class="top"><p class="src"><a name="v:myThreadId" class="def">myThreadId</a> :: <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t <a href="Test-DejaFu-Deterministic-Schedule.html#t:ThreadId">ThreadId</a> <a href="src/Test-DejaFu-Deterministic-IO.html#myThreadId" class="link">Source</a></p><div class="doc"><p>Get the <code><a href="Test-DejaFu-Deterministic-Schedule.html#t:ThreadId">ThreadId</a></code> of the current thread.</p></div></div><div class="top"><p class="src"><a name="v:spawn" class="def">spawn</a> :: <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t (<a href="Test-DejaFu-Deterministic-IO.html#t:CVar">CVar</a> t a) <a href="src/Test-DejaFu-Deterministic-IO.html#spawn" class="link">Source</a></p><div class="doc"><p>Run the provided computation concurrently, returning the result.</p></div></div><div class="top"><p class="src"><a name="v:atomically" class="def">atomically</a> :: <a href="Test-DejaFu-STM.html#t:STMLike">STMLike</a> t <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a> <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-IORef.html#t:IORef">IORef</a> a -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a <a href="src/Test-DejaFu-Deterministic-IO.html#atomically" class="link">Source</a></p><div class="doc"><p>Run the provided <code>MonadSTM</code> transaction atomically. If <code>retry</code> is
 called, it will be blocked until any of the touched <code><a href="Test-DejaFu-STM.html#t:CTVar">CTVar</a></code>s have
 been written to.</p></div></div><div class="top"><p class="src"><a name="v:throw" class="def">throw</a> :: <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Control-Exception-Base.html#t:Exception">Exception</a> e =&gt; e -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a <a href="src/Test-DejaFu-Deterministic-IO.html#throw" class="link">Source</a></p><div class="doc"><p>Raise an exception in the <code><a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a></code> monad. The exception is raised
 when the action is run, not when it is applied. It short-citcuits
 the rest of the computation:</p><pre>throw e &gt;&gt; x == throw e</pre></div></div><div class="top"><p class="src"><a name="v:throwTo" class="def">throwTo</a> :: <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Control-Exception-Base.html#t:Exception">Exception</a> e =&gt; <a href="Test-DejaFu-Deterministic-Schedule.html#t:ThreadId">ThreadId</a> -&gt; e -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t () <a href="src/Test-DejaFu-Deterministic-IO.html#throwTo" class="link">Source</a></p><div class="doc"><p>Throw an exception to the target thread. This blocks until the
 exception is delivered, and it is just as if the target thread had
 raised it with <code><a href="Test-DejaFu-Deterministic-IO.html#v:throw">throw</a></code>. This can interrupt a blocked action.</p></div></div><div class="top"><p class="src"><a name="v:killThread" class="def">killThread</a> :: <a href="Test-DejaFu-Deterministic-Schedule.html#t:ThreadId">ThreadId</a> -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t () <a href="src/Test-DejaFu-Deterministic-IO.html#killThread" class="link">Source</a></p><div class="doc"><p>Raise the <code>ThreadKilled</code> exception in the target thread. Note
 that if the thread is prepared to catch this exception, it won't
 actually kill it.</p></div></div><div class="top"><p class="src"><a name="v:catch" class="def">catch</a> :: <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Control-Exception-Base.html#t:Exception">Exception</a> e =&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a -&gt; (e -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a) -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a <a href="src/Test-DejaFu-Deterministic-IO.html#catch" class="link">Source</a></p><div class="doc"><p>Catch an exception raised by <code><a href="Test-DejaFu-Deterministic-IO.html#v:throw">throw</a></code>. This <strong>cannot</strong> catch
 errors, such as evaluating <code><a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Prelude.html#v:undefined">undefined</a></code>, or division by zero. If you
 need that, use Control.Exception.catch and <code><a href="Test-DejaFu-Deterministic-IO.html#v:liftIO">liftIO</a></code>.</p></div></div><div class="top"><p class="src"><a name="v:mask" class="def">mask</a> :: ((<span class="keyword">forall</span> a. <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a) -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t b) -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t b <a href="src/Test-DejaFu-Deterministic-IO.html#mask" class="link">Source</a></p><div class="doc"><p>Executes a computation with asynchronous exceptions
 <em>masked</em>. That is, any thread which attempts to raise an exception
 in the current thread with <code><a href="Test-DejaFu-Deterministic-IO.html#v:throwTo">throwTo</a></code> will be blocked until
 asynchronous exceptions are unmasked again.</p><p>The argument passed to mask is a function that takes as its
 argument another function, which can be used to restore the
 prevailing masking state within the context of the masked
 computation. This function should not be used within an
 <code><a href="Test-DejaFu-Deterministic-IO.html#v:uninterruptibleMask">uninterruptibleMask</a></code>.</p></div></div><div class="top"><p class="src"><a name="v:uninterruptibleMask" class="def">uninterruptibleMask</a> :: ((<span class="keyword">forall</span> a. <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a) -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t b) -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t b <a href="src/Test-DejaFu-Deterministic-IO.html#uninterruptibleMask" class="link">Source</a></p><div class="doc"><p>Like <code><a href="Test-DejaFu-Deterministic-IO.html#v:mask">mask</a></code>, but the masked computation is not
 interruptible. THIS SHOULD BE USED WITH GREAT CARE, because if a
 thread executing in <code><a href="Test-DejaFu-Deterministic-IO.html#v:uninterruptibleMask">uninterruptibleMask</a></code> blocks for any reason,
 then the thread (and possibly the program, if this is the main
 thread) will be unresponsive and unkillable. This function should
 only be necessary if you need to mask exceptions around an
 interruptible operation, and you can guarantee that the
 interruptible operation will only block for a short period of
 time. The supplied unmasking function should not be used within a
 <code><a href="Test-DejaFu-Deterministic-IO.html#v:mask">mask</a></code>.</p></div></div><h1 id="g:2"><code>CVar</code>s</h1><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:CVar" class="def">CVar</a> t a <a href="src/Test-DejaFu-Deterministic-IO.html#CVar" class="link">Source</a></p><div class="doc"><p>The concurrent variable type used with the <code><a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a></code> monad. These
 behave the same as <code>Conc</code>'s <code>CVar</code>s</p></div><div class="subs instances"><p id="control.i:CVar" class="caption collapser" onclick="toggleSection('i:CVar')">Instances</p><div id="section.i:CVar" class="show"><table><tr><td class="src"><a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Eq.html#t:Eq">Eq</a> (<a href="Test-DejaFu-Deterministic-IO.html#t:CVar">CVar</a> t a) <a href="src/Test-DejaFu-Deterministic-IO.html#line-136" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><a name="v:newEmptyCVar" class="def">newEmptyCVar</a> :: <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t (<a href="Test-DejaFu-Deterministic-IO.html#t:CVar">CVar</a> t a) <a href="src/Test-DejaFu-Deterministic-IO.html#newEmptyCVar" class="link">Source</a></p><div class="doc"><p>Create a new empty <code><a href="Test-DejaFu-Deterministic-IO.html#t:CVar">CVar</a></code>.</p></div></div><div class="top"><p class="src"><a name="v:putCVar" class="def">putCVar</a> :: <a href="Test-DejaFu-Deterministic-IO.html#t:CVar">CVar</a> t a -&gt; a -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t () <a href="src/Test-DejaFu-Deterministic-IO.html#putCVar" class="link">Source</a></p><div class="doc"><p>Block on a <code><a href="Test-DejaFu-Deterministic-IO.html#t:CVar">CVar</a></code> until it is empty, then write to it.</p></div></div><div class="top"><p class="src"><a name="v:tryPutCVar" class="def">tryPutCVar</a> :: <a href="Test-DejaFu-Deterministic-IO.html#t:CVar">CVar</a> t a -&gt; a -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#t:Bool">Bool</a> <a href="src/Test-DejaFu-Deterministic-IO.html#tryPutCVar" class="link">Source</a></p><div class="doc"><p>Put a value into a <code><a href="Test-DejaFu-Deterministic-IO.html#t:CVar">CVar</a></code> if there isn't one, without blocking.</p></div></div><div class="top"><p class="src"><a name="v:readCVar" class="def">readCVar</a> :: <a href="Test-DejaFu-Deterministic-IO.html#t:CVar">CVar</a> t a -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a <a href="src/Test-DejaFu-Deterministic-IO.html#readCVar" class="link">Source</a></p><div class="doc"><p>Block on a <code><a href="Test-DejaFu-Deterministic-IO.html#t:CVar">CVar</a></code> until it is full, then read from it (without
 emptying).</p></div></div><div class="top"><p class="src"><a name="v:takeCVar" class="def">takeCVar</a> :: <a href="Test-DejaFu-Deterministic-IO.html#t:CVar">CVar</a> t a -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a <a href="src/Test-DejaFu-Deterministic-IO.html#takeCVar" class="link">Source</a></p><div class="doc"><p>Block on a <code><a href="Test-DejaFu-Deterministic-IO.html#t:CVar">CVar</a></code> until it is full, then read from it (with
 emptying).</p></div></div><div class="top"><p class="src"><a name="v:tryTakeCVar" class="def">tryTakeCVar</a> :: <a href="Test-DejaFu-Deterministic-IO.html#t:CVar">CVar</a> t a -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Maybe.html#t:Maybe">Maybe</a> a) <a href="src/Test-DejaFu-Deterministic-IO.html#tryTakeCVar" class="link">Source</a></p><div class="doc"><p>Read a value from a <code><a href="Test-DejaFu-Deterministic-IO.html#t:CVar">CVar</a></code> if there is one, without blocking.</p></div></div><h1 id="g:3"><code>CRef</code>s</h1><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:CRef" class="def">CRef</a> t a <a href="src/Test-DejaFu-Deterministic-IO.html#CRef" class="link">Source</a></p><div class="doc"><p>The mutable non-blocking reference type. These behave the same as
 <code>Conc</code>'s <code>CRef</code>s</p></div><div class="subs instances"><p id="control.i:CRef" class="caption collapser" onclick="toggleSection('i:CRef')">Instances</p><div id="section.i:CRef" class="show"><table><tr><td class="src"><a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Eq.html#t:Eq">Eq</a> (<a href="Test-DejaFu-Deterministic-IO.html#t:CRef">CRef</a> t a) <a href="src/Test-DejaFu-Deterministic-IO.html#line-140" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><a name="v:newCRef" class="def">newCRef</a> :: a -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t (<a href="Test-DejaFu-Deterministic-IO.html#t:CRef">CRef</a> t a) <a href="src/Test-DejaFu-Deterministic-IO.html#newCRef" class="link">Source</a></p><div class="doc"><p>Create a new <code><a href="Test-DejaFu-Deterministic-IO.html#t:CRef">CRef</a></code>.</p></div></div><div class="top"><p class="src"><a name="v:readCRef" class="def">readCRef</a> :: <a href="Test-DejaFu-Deterministic-IO.html#t:CRef">CRef</a> t a -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a <a href="src/Test-DejaFu-Deterministic-IO.html#readCRef" class="link">Source</a></p><div class="doc"><p>Read the value from a <code><a href="Test-DejaFu-Deterministic-IO.html#t:CRef">CRef</a></code>.</p></div></div><div class="top"><p class="src"><a name="v:writeCRef" class="def">writeCRef</a> :: <a href="Test-DejaFu-Deterministic-IO.html#t:CRef">CRef</a> t a -&gt; a -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t () <a href="src/Test-DejaFu-Deterministic-IO.html#writeCRef" class="link">Source</a></p><div class="doc"><p>Replace the value stored inside a <code><a href="Test-DejaFu-Deterministic-IO.html#t:CRef">CRef</a></code>.</p></div></div><div class="top"><p class="src"><a name="v:modifyCRef" class="def">modifyCRef</a> :: <a href="Test-DejaFu-Deterministic-IO.html#t:CRef">CRef</a> t a -&gt; (a -&gt; (a, b)) -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t b <a href="src/Test-DejaFu-Deterministic-IO.html#modifyCRef" class="link">Source</a></p><div class="doc"><p>Atomically modify the value inside a <code><a href="Test-DejaFu-Deterministic-IO.html#t:CRef">CRef</a></code>.</p></div></div><h1 id="g:4">Testing</h1><div class="top"><p class="src"><a name="v:_concNoTest" class="def">_concNoTest</a> :: <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a <a href="src/Test-DejaFu-Deterministic-IO.html#_concNoTest" class="link">Source</a></p><div class="doc"><p>Run the argument in one step. If the argument fails, the whole
 computation will fail.</p></div></div><div class="top"><p class="src"><a name="v:_concKnowsAbout" class="def">_concKnowsAbout</a> :: <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Either.html#t:Either">Either</a> (<a href="Test-DejaFu-Deterministic-IO.html#t:CVar">CVar</a> t a) (<a href="Test-DejaFu-STM.html#t:CTVar">CTVar</a> t <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-IORef.html#t:IORef">IORef</a> a) -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t () <a href="src/Test-DejaFu-Deterministic-IO.html#_concKnowsAbout" class="link">Source</a></p><div class="doc"><p>Record that the referenced variable is known by the current thread.</p></div></div><div class="top"><p class="src"><a name="v:_concForgets" class="def">_concForgets</a> :: <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Either.html#t:Either">Either</a> (<a href="Test-DejaFu-Deterministic-IO.html#t:CVar">CVar</a> t a) (<a href="Test-DejaFu-STM.html#t:CTVar">CTVar</a> t <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-IORef.html#t:IORef">IORef</a> a) -&gt; <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t () <a href="src/Test-DejaFu-Deterministic-IO.html#_concForgets" class="link">Source</a></p><div class="doc"><p>Record that the referenced variable will never be touched by the
 current thread.</p></div></div><div class="top"><p class="src"><a name="v:_concAllKnown" class="def">_concAllKnown</a> :: <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t () <a href="src/Test-DejaFu-Deterministic-IO.html#_concAllKnown" class="link">Source</a></p><div class="doc"><p>Record that all <code><a href="Test-DejaFu-Deterministic-IO.html#t:CVar">CVar</a></code>s and <code><a href="Test-DejaFu-STM.html#t:CTVar">CTVar</a></code>s known by the current thread
 have been passed to <code><a href="Test-DejaFu-Deterministic-IO.html#v:_concKnowsAbout">_concKnowsAbout</a></code>.</p></div></div><h1 id="g:5">Execution traces</h1><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:Trace" class="def">Trace</a> = [(<a href="Test-DejaFu-Deterministic-IO.html#t:Decision">Decision</a>, [<a href="Test-DejaFu-Deterministic-IO.html#t:Decision">Decision</a>], <a href="Test-DejaFu-Deterministic-IO.html#t:ThreadAction">ThreadAction</a>)] <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#Trace" class="link">Source</a></p><div class="doc"><p>One of the outputs of the runner is a <code>Trace</code>, which is a log of
 decisions made, alternative decisions, and the action a thread took
 in its step.</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:Decision" class="def">Decision</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#Decision" class="link">Source</a></p><div class="doc"><p>Scheduling decisions are based on the state of the running
 program, and so we can capture some of that state in recording what
 specific decision we made.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:Start" class="def">Start</a> <a href="Test-DejaFu-Deterministic-Schedule.html#t:ThreadId">ThreadId</a></td><td class="doc"><p>Start a new thread, because the last was blocked (or it's the
 start of computation).</p></td></tr><tr><td class="src"><a name="v:Continue" class="def">Continue</a></td><td class="doc"><p>Continue running the last thread for another step.</p></td></tr><tr><td class="src"><a name="v:SwitchTo" class="def">SwitchTo</a> <a href="Test-DejaFu-Deterministic-Schedule.html#t:ThreadId">ThreadId</a></td><td class="doc"><p>Pre-empt the running thread, and switch to another.</p></td></tr></table></div><div class="subs instances"><p id="control.i:Decision" class="caption collapser" onclick="toggleSection('i:Decision')">Instances</p><div id="section.i:Decision" class="show"><table><tr><td class="src"><a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Eq.html#t:Eq">Eq</a> <a href="Test-DejaFu-Deterministic-IO.html#t:Decision">Decision</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#line-141" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Text-Show.html#t:Show">Show</a> <a href="Test-DejaFu-Deterministic-IO.html#t:Decision">Decision</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#line-141" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="https://hackage.haskell.org/package/deepseq-1.4.1.1/docs/Control-DeepSeq.html#t:NFData">NFData</a> <a href="Test-DejaFu-Deterministic-IO.html#t:Decision">Decision</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#line-143" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:ThreadAction" class="def">ThreadAction</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#ThreadAction" class="link">Source</a></p><div class="doc"><p>All the actions that a thread can perform.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:Fork" class="def">Fork</a> <a href="Test-DejaFu-Deterministic-Schedule.html#t:ThreadId">ThreadId</a></td><td class="doc"><p>Start a new thread.</p></td></tr><tr><td class="src"><a name="v:MyThreadId" class="def">MyThreadId</a></td><td class="doc"><p>Get the <code><a href="Test-DejaFu-Deterministic-Schedule.html#t:ThreadId">ThreadId</a></code> of the current thread.</p></td></tr><tr><td class="src"><a name="v:New" class="def">New</a> <a href="Test-DejaFu-Deterministic-IO.html#t:CVarId">CVarId</a></td><td class="doc"><p>Create a new <code>CVar</code>.</p></td></tr><tr><td class="src"><a name="v:Put" class="def">Put</a> <a href="Test-DejaFu-Deterministic-IO.html#t:CVarId">CVarId</a> [<a href="Test-DejaFu-Deterministic-Schedule.html#t:ThreadId">ThreadId</a>]</td><td class="doc"><p>Put into a <code>CVar</code>, possibly waking up some threads.</p></td></tr><tr><td class="src"><a name="v:BlockedPut" class="def">BlockedPut</a> <a href="Test-DejaFu-Deterministic-IO.html#t:CVarId">CVarId</a></td><td class="doc"><p>Get blocked on a put.</p></td></tr><tr><td class="src"><a name="v:TryPut" class="def">TryPut</a> <a href="Test-DejaFu-Deterministic-IO.html#t:CVarId">CVarId</a> <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#t:Bool">Bool</a> [<a href="Test-DejaFu-Deterministic-Schedule.html#t:ThreadId">ThreadId</a>]</td><td class="doc"><p>Try to put into a <code>CVar</code>, possibly waking up some threads.</p></td></tr><tr><td class="src"><a name="v:Read" class="def">Read</a> <a href="Test-DejaFu-Deterministic-IO.html#t:CVarId">CVarId</a></td><td class="doc"><p>Read from a <code>CVar</code>.</p></td></tr><tr><td class="src"><a name="v:BlockedRead" class="def">BlockedRead</a> <a href="Test-DejaFu-Deterministic-IO.html#t:CVarId">CVarId</a></td><td class="doc"><p>Get blocked on a read.</p></td></tr><tr><td class="src"><a name="v:Take" class="def">Take</a> <a href="Test-DejaFu-Deterministic-IO.html#t:CVarId">CVarId</a> [<a href="Test-DejaFu-Deterministic-Schedule.html#t:ThreadId">ThreadId</a>]</td><td class="doc"><p>Take from a <code>CVar</code>, possibly waking up some threads.</p></td></tr><tr><td class="src"><a name="v:BlockedTake" class="def">BlockedTake</a> <a href="Test-DejaFu-Deterministic-IO.html#t:CVarId">CVarId</a></td><td class="doc"><p>Get blocked on a take.</p></td></tr><tr><td class="src"><a name="v:TryTake" class="def">TryTake</a> <a href="Test-DejaFu-Deterministic-IO.html#t:CVarId">CVarId</a> <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#t:Bool">Bool</a> [<a href="Test-DejaFu-Deterministic-Schedule.html#t:ThreadId">ThreadId</a>]</td><td class="doc"><p>Try to take from a <code>CVar</code>, possibly waking up some threads.</p></td></tr><tr><td class="src"><a name="v:NewRef" class="def">NewRef</a> <a href="Test-DejaFu-Deterministic.html#t:CRefId">CRefId</a></td><td class="doc"><p>Create a new <code>CRef</code>.</p></td></tr><tr><td class="src"><a name="v:ReadRef" class="def">ReadRef</a> <a href="Test-DejaFu-Deterministic.html#t:CRefId">CRefId</a></td><td class="doc"><p>Read from a <code>CRef</code>.</p></td></tr><tr><td class="src"><a name="v:ModRef" class="def">ModRef</a> <a href="Test-DejaFu-Deterministic.html#t:CRefId">CRefId</a></td><td class="doc"><p>Modify a <code>CRef</code>.</p></td></tr><tr><td class="src"><a name="v:STM" class="def">STM</a> [<a href="Test-DejaFu-Deterministic-Schedule.html#t:ThreadId">ThreadId</a>]</td><td class="doc"><p>An STM transaction was executed, possibly waking up some
 threads.</p></td></tr><tr><td class="src"><a name="v:FreshSTM" class="def">FreshSTM</a></td><td class="doc"><p>An STM transaction was executed, and all it did was create and
 write to new <code>CTVar</code>s, no existing <code>CTVar</code>s were touched.</p></td></tr><tr><td class="src"><a name="v:BlockedSTM" class="def">BlockedSTM</a></td><td class="doc"><p>Got blocked in an STM transaction.</p></td></tr><tr><td class="src"><a name="v:Catching" class="def">Catching</a></td><td class="doc"><p>Register a new exception handler</p></td></tr><tr><td class="src"><a name="v:PopCatching" class="def">PopCatching</a></td><td class="doc"><p>Pop the innermost exception handler from the stack.</p></td></tr><tr><td class="src"><a name="v:Throw" class="def">Throw</a></td><td class="doc"><p>Throw an exception.</p></td></tr><tr><td class="src"><a name="v:ThrowTo" class="def">ThrowTo</a> <a href="Test-DejaFu-Deterministic-Schedule.html#t:ThreadId">ThreadId</a></td><td class="doc"><p>Throw an exception to a thread.</p></td></tr><tr><td class="src"><a name="v:BlockedThrowTo" class="def">BlockedThrowTo</a> <a href="Test-DejaFu-Deterministic-Schedule.html#t:ThreadId">ThreadId</a></td><td class="doc"><p>Get blocked on a <code>throwTo</code>.</p></td></tr><tr><td class="src"><a name="v:Killed" class="def">Killed</a></td><td class="doc"><p>Killed by an uncaught exception.</p></td></tr><tr><td class="src"><a name="v:SetMasking" class="def">SetMasking</a> <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#t:Bool">Bool</a> <a href="Test-DejaFu-Deterministic-IO.html#t:MaskingState">MaskingState</a></td><td class="doc"><p>Set the masking state. If <code><a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#v:True">True</a></code>, this is being used to set the
 masking state to the original state in the argument passed to a
 <code>mask</code>ed function.</p></td></tr><tr><td class="src"><a name="v:ResetMasking" class="def">ResetMasking</a> <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#t:Bool">Bool</a> <a href="Test-DejaFu-Deterministic-IO.html#t:MaskingState">MaskingState</a></td><td class="doc"><p>Return to an earlier masking state.  If <code><a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#v:True">True</a></code>, this is being
 used to return to the state of the masked block in the argument
 passed to a <code>mask</code>ed function.</p></td></tr><tr><td class="src"><a name="v:Lift" class="def">Lift</a></td><td class="doc"><p>Lift an action from the underlying monad. Note that the
 penultimate action in a trace will always be a <code>Lift</code>, this is an
 artefact of how the runner works.</p></td></tr><tr><td class="src"><a name="v:NoTest" class="def">NoTest</a></td><td class="doc"><p>A computation annotated with <code>_concNoTest</code> was executed in a
 single step.</p></td></tr><tr><td class="src"><a name="v:KnowsAbout" class="def">KnowsAbout</a></td><td class="doc"><p>A <code>_concKnowsAbout</code> annotation was processed.</p></td></tr><tr><td class="src"><a name="v:Forgets" class="def">Forgets</a></td><td class="doc"><p>A <code>_concForgets</code> annotation was processed.</p></td></tr><tr><td class="src"><a name="v:AllKnown" class="def">AllKnown</a></td><td class="doc"><p>A <code>_concALlKnown</code> annotation was processed.</p></td></tr><tr><td class="src"><a name="v:Stop" class="def">Stop</a></td><td class="doc"><p>Cease execution and terminate.</p></td></tr></table></div><div class="subs instances"><p id="control.i:ThreadAction" class="caption collapser" onclick="toggleSection('i:ThreadAction')">Instances</p><div id="section.i:ThreadAction" class="show"><table><tr><td class="src"><a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Eq.html#t:Eq">Eq</a> <a href="Test-DejaFu-Deterministic-IO.html#t:ThreadAction">ThreadAction</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#line-221" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Text-Show.html#t:Show">Show</a> <a href="Test-DejaFu-Deterministic-IO.html#t:ThreadAction">ThreadAction</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#line-221" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="https://hackage.haskell.org/package/deepseq-1.4.1.1/docs/Control-DeepSeq.html#t:NFData">NFData</a> <a href="Test-DejaFu-Deterministic-IO.html#t:ThreadAction">ThreadAction</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#line-223" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:CVarId" class="def">CVarId</a> = <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Int.html#t:Int">Int</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#CVarId" class="link">Source</a></p><div class="doc"><p>Every <code>CVar</code> also has a unique identifier.</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:MaskingState" class="def">MaskingState</a> :: *</p><div class="doc"><p>Describes the behaviour of a thread when an asynchronous
 exception is received.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:Unmasked" class="def">Unmasked</a></td><td class="doc"><p>asynchronous exceptions are unmasked (the normal state)</p></td></tr><tr><td class="src"><a name="v:MaskedInterruptible" class="def">MaskedInterruptible</a></td><td class="doc"><p>the state during <code><a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Control-Exception-Base.html#v:mask">mask</a></code>: asynchronous exceptions are masked, but blocking operations may still be interrupted</p></td></tr><tr><td class="src"><a name="v:MaskedUninterruptible" class="def">MaskedUninterruptible</a></td><td class="doc"><p>the state during <code><a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Control-Exception-Base.html#v:uninterruptibleMask">uninterruptibleMask</a></code>: asynchronous exceptions are masked, and blocking operations may not be interrupted</p></td></tr></table></div><div class="subs instances"><p id="control.i:MaskingState" class="caption collapser" onclick="toggleSection('i:MaskingState')">Instances</p><div id="section.i:MaskingState" class="show"><table><tr><td class="src"><a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Eq.html#t:Eq">Eq</a> <a href="Test-DejaFu-Deterministic-IO.html#t:MaskingState">MaskingState</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Text-Show.html#t:Show">Show</a> <a href="Test-DejaFu-Deterministic-IO.html#t:MaskingState">MaskingState</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><a name="v:showTrace" class="def">showTrace</a> :: <a href="Test-DejaFu-Deterministic-IO.html#t:Trace">Trace</a> -&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-String.html#t:String">String</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#showTrace" class="link">Source</a></p><div class="doc"><p>Pretty-print a trace.</p></div></div><h1 id="g:6">Scheduling</h1><div class="top"><p class="src">module <a href="Test-DejaFu-Deterministic-Schedule.html">Test.DejaFu.Deterministic.Schedule</a></p></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.16.0</p></div></body></html>