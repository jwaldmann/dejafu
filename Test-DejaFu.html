<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Test.DejaFu</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Test-DejaFu.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Test-DejaFu.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">dejafu-0.2.0.0: Overloadable primitives for testable, potentially non-deterministic, concurrency.</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Test.DejaFu</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Testing</a></li><li><a href="#g:2">Testing under Relaxed Memory</a></li><li><a href="#g:3">Results</a></li><li><a href="#g:4">Predicates</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Deterministic testing for concurrent computations.</p><p>As an example, consider this program, which has two locks and a
 shared variable. Two threads are spawned, which claim the locks,
 update the shared variable, and release the locks. The main thread
 waits for them both to terminate, and returns the final result.</p><pre>example1 :: MonadConc m =&gt; m Int
example1 = do
  a &lt;- newEmptyCVar
  b &lt;- newEmptyCVar

  c &lt;- newCVar 0

  j1 &lt;- spawn $ lock a &gt;&gt; lock b &gt;&gt; modifyCVar_ c (return . succ) &gt;&gt; unlock b &gt;&gt; unlock a
  j2 &lt;- spawn $ lock b &gt;&gt; lock a &gt;&gt; modifyCVar_ c (return . pred) &gt;&gt; unlock a &gt;&gt; unlock b

  takeCVar j1
  takeCVar j2

  takeCVar c</pre><p>The correct result is 0, as it starts out as 0 and is incremented
 and decremented by threads 1 and 2, respectively. However, note the
 order of acquisition of the locks in the two threads. If thread 2
 pre-empts thread 1 between the acquisition of the locks (or if
 thread 1 pre-empts thread 2), a deadlock situation will arise, as
 thread 1 will have lock <code>a</code> and be waiting on <code>b</code>, and thread 2
 will have <code>b</code> and be waiting on <code>a</code>.</p><p>Here is what Deja Fu has to say about it:</p><pre>&gt; autocheck example1
[fail] Never Deadlocks (checked: 2)
        [deadlock] S0---------S1--P2---S1-
[pass] No Exceptions (checked: 11)
[fail] Consistent Result (checked: 10)
        0 S0---------S1---------------S0--S2---------------S0----
        [deadlock] S0---------S1--P2---S1-
False</pre><p>It identifies the deadlock, and also the possible results the
 computation can produce, and displays a simplified trace leading to
 each failing outcome. It also returns <code>False</code> as there are test
 failures. The automatic testing functionality is good enough if you
 only want to check your computation is deterministic, but if you
 have more specific requirements (or have some expected and
 tolerated level of nondeterminism), you can write tests yourself
 using the <code>dejafu*</code> functions.</p><p><strong>Warning:</strong> If your computation under test does <code>IO</code>, the <code>IO</code>
 will be executed lots of times! Be sure that it is deterministic
 enough not to invalidate your test results. Mocking may be useful
 where possible.</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><a href="#v:autocheck">autocheck</a> :: (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Eq.html#t:Eq">Eq</a> a, <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Text-Show.html#t:Show">Show</a> a) =&gt; (<span class="keyword">forall</span> t. <a href="Test-DejaFu-Deterministic.html#t:Conc">Conc</a> t a) -&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a> <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#t:Bool">Bool</a></li><li class="src short"><a href="#v:dejafu">dejafu</a> :: (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Eq.html#t:Eq">Eq</a> a, <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Text-Show.html#t:Show">Show</a> a) =&gt; (<span class="keyword">forall</span> t. <a href="Test-DejaFu-Deterministic.html#t:Conc">Conc</a> t a) -&gt; (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-String.html#t:String">String</a>, <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a) -&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a> <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#t:Bool">Bool</a></li><li class="src short"><a href="#v:dejafus">dejafus</a> :: (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Eq.html#t:Eq">Eq</a> a, <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Text-Show.html#t:Show">Show</a> a) =&gt; (<span class="keyword">forall</span> t. <a href="Test-DejaFu-Deterministic.html#t:Conc">Conc</a> t a) -&gt; [(<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-String.html#t:String">String</a>, <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a)] -&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a> <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#t:Bool">Bool</a></li><li class="src short"><a href="#v:autocheckIO">autocheckIO</a> :: (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Eq.html#t:Eq">Eq</a> a, <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Text-Show.html#t:Show">Show</a> a) =&gt; (<span class="keyword">forall</span> t. <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a) -&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a> <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#t:Bool">Bool</a></li><li class="src short"><a href="#v:dejafuIO">dejafuIO</a> :: (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Eq.html#t:Eq">Eq</a> a, <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Text-Show.html#t:Show">Show</a> a) =&gt; (<span class="keyword">forall</span> t. <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a) -&gt; (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-String.html#t:String">String</a>, <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a) -&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a> <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#t:Bool">Bool</a></li><li class="src short"><a href="#v:dejafusIO">dejafusIO</a> :: (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Eq.html#t:Eq">Eq</a> a, <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Text-Show.html#t:Show">Show</a> a) =&gt; (<span class="keyword">forall</span> t. <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a) -&gt; [(<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-String.html#t:String">String</a>, <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a)] -&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a> <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#t:Bool">Bool</a></li><li class="src short"><span class="keyword">data</span> <a href="#t:MemType">MemType</a><ul class="subs"><li>= <a href="#v:SequentialConsistency">SequentialConsistency</a></li><li>| <a href="#v:TotalStoreOrder">TotalStoreOrder</a></li><li>| <a href="#v:PartialStoreOrder">PartialStoreOrder</a></li></ul></li><li class="src short"><a href="#v:autocheck-39-">autocheck'</a> :: (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Eq.html#t:Eq">Eq</a> a, <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Text-Show.html#t:Show">Show</a> a) =&gt; <a href="Test-DejaFu.html#t:MemType">MemType</a> -&gt; (<span class="keyword">forall</span> t. <a href="Test-DejaFu-Deterministic.html#t:Conc">Conc</a> t a) -&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a> <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#t:Bool">Bool</a></li><li class="src short"><a href="#v:autocheckIO-39-">autocheckIO'</a> :: (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Eq.html#t:Eq">Eq</a> a, <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Text-Show.html#t:Show">Show</a> a) =&gt; <a href="Test-DejaFu.html#t:MemType">MemType</a> -&gt; (<span class="keyword">forall</span> t. <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a) -&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a> <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#t:Bool">Bool</a></li><li class="src short"><a href="#v:dejafu-39-">dejafu'</a> :: (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Eq.html#t:Eq">Eq</a> a, <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Text-Show.html#t:Show">Show</a> a) =&gt; <a href="Test-DejaFu.html#t:MemType">MemType</a> -&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Int.html#t:Int">Int</a> -&gt; (<span class="keyword">forall</span> t. <a href="Test-DejaFu-Deterministic.html#t:Conc">Conc</a> t a) -&gt; (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-String.html#t:String">String</a>, <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a) -&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a> <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#t:Bool">Bool</a></li><li class="src short"><a href="#v:dejafus-39-">dejafus'</a> :: (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Eq.html#t:Eq">Eq</a> a, <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Text-Show.html#t:Show">Show</a> a) =&gt; <a href="Test-DejaFu.html#t:MemType">MemType</a> -&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Int.html#t:Int">Int</a> -&gt; (<span class="keyword">forall</span> t. <a href="Test-DejaFu-Deterministic.html#t:Conc">Conc</a> t a) -&gt; [(<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-String.html#t:String">String</a>, <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a)] -&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a> <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#t:Bool">Bool</a></li><li class="src short"><a href="#v:dejafuIO-39-">dejafuIO'</a> :: (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Eq.html#t:Eq">Eq</a> a, <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Text-Show.html#t:Show">Show</a> a) =&gt; <a href="Test-DejaFu.html#t:MemType">MemType</a> -&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Int.html#t:Int">Int</a> -&gt; (<span class="keyword">forall</span> t. <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a) -&gt; (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-String.html#t:String">String</a>, <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a) -&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a> <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#t:Bool">Bool</a></li><li class="src short"><a href="#v:dejafusIO-39-">dejafusIO'</a> :: (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Eq.html#t:Eq">Eq</a> a, <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Text-Show.html#t:Show">Show</a> a) =&gt; <a href="Test-DejaFu.html#t:MemType">MemType</a> -&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Int.html#t:Int">Int</a> -&gt; (<span class="keyword">forall</span> t. <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a) -&gt; [(<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-String.html#t:String">String</a>, <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a)] -&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a> <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#t:Bool">Bool</a></li><li class="src short"><span class="keyword">data</span> <a href="#t:Result">Result</a> a = <a href="#v:Result">Result</a> {<ul class="subs"><li><a href="#v:_pass">_pass</a> :: <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#t:Bool">Bool</a></li><li><a href="#v:_casesChecked">_casesChecked</a> :: <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Int.html#t:Int">Int</a></li><li><a href="#v:_failures">_failures</a> :: [(<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Either.html#t:Either">Either</a> <a href="Test-DejaFu.html#t:Failure">Failure</a> a, <a href="Test-DejaFu-Deterministic.html#t:Trace">Trace</a>)]</li></ul>}</li><li class="src short"><span class="keyword">data</span> <a href="#t:Failure">Failure</a><ul class="subs"><li>= <a href="#v:InternalError">InternalError</a></li><li>| <a href="#v:Deadlock">Deadlock</a></li><li>| <a href="#v:STMDeadlock">STMDeadlock</a></li><li>| <a href="#v:UncaughtException">UncaughtException</a></li></ul></li><li class="src short"><a href="#v:runTest">runTest</a> :: <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a -&gt; (<span class="keyword">forall</span> t. <a href="Test-DejaFu-Deterministic.html#t:Conc">Conc</a> t a) -&gt; <a href="Test-DejaFu.html#t:Result">Result</a> a</li><li class="src short"><a href="#v:runTest-39-">runTest'</a> :: <a href="Test-DejaFu.html#t:MemType">MemType</a> -&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Int.html#t:Int">Int</a> -&gt; <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a -&gt; (<span class="keyword">forall</span> t. <a href="Test-DejaFu-Deterministic.html#t:Conc">Conc</a> t a) -&gt; <a href="Test-DejaFu.html#t:Result">Result</a> a</li><li class="src short"><a href="#v:runTestIO">runTestIO</a> :: <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a -&gt; (<span class="keyword">forall</span> t. <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a) -&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a> (<a href="Test-DejaFu.html#t:Result">Result</a> a)</li><li class="src short"><a href="#v:runTestIO-39-">runTestIO'</a> :: <a href="Test-DejaFu.html#t:MemType">MemType</a> -&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Int.html#t:Int">Int</a> -&gt; <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a -&gt; (<span class="keyword">forall</span> t. <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a) -&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a> (<a href="Test-DejaFu.html#t:Result">Result</a> a)</li><li class="src short"><span class="keyword">type</span> <a href="#t:Predicate">Predicate</a> a = [(<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Either.html#t:Either">Either</a> <a href="Test-DejaFu.html#t:Failure">Failure</a> a, <a href="Test-DejaFu-Deterministic.html#t:Trace">Trace</a>)] -&gt; <a href="Test-DejaFu.html#t:Result">Result</a> a</li><li class="src short"><a href="#v:deadlocksNever">deadlocksNever</a> :: <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a</li><li class="src short"><a href="#v:deadlocksAlways">deadlocksAlways</a> :: <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a</li><li class="src short"><a href="#v:deadlocksSometimes">deadlocksSometimes</a> :: <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a</li><li class="src short"><a href="#v:exceptionsNever">exceptionsNever</a> :: <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a</li><li class="src short"><a href="#v:exceptionsAlways">exceptionsAlways</a> :: <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a</li><li class="src short"><a href="#v:exceptionsSometimes">exceptionsSometimes</a> :: <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a</li><li class="src short"><a href="#v:alwaysSame">alwaysSame</a> :: <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Eq.html#t:Eq">Eq</a> a =&gt; <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a</li><li class="src short"><a href="#v:notAlwaysSame">notAlwaysSame</a> :: <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Eq.html#t:Eq">Eq</a> a =&gt; <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a</li><li class="src short"><a href="#v:alwaysTrue">alwaysTrue</a> :: (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Either.html#t:Either">Either</a> <a href="Test-DejaFu.html#t:Failure">Failure</a> a -&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#t:Bool">Bool</a>) -&gt; <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a</li><li class="src short"><a href="#v:alwaysTrue2">alwaysTrue2</a> :: (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Either.html#t:Either">Either</a> <a href="Test-DejaFu.html#t:Failure">Failure</a> a -&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Either.html#t:Either">Either</a> <a href="Test-DejaFu.html#t:Failure">Failure</a> a -&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#t:Bool">Bool</a>) -&gt; <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a</li><li class="src short"><a href="#v:somewhereTrue">somewhereTrue</a> :: (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Either.html#t:Either">Either</a> <a href="Test-DejaFu.html#t:Failure">Failure</a> a -&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#t:Bool">Bool</a>) -&gt; <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a</li></ul></div><div id="interface"><h1 id="g:1">Testing</h1><div class="doc"><p>Testing in Deja Fu is similar to unit testing, the programmer
 produces a self-contained monadic action to execute under
 different schedules, and supplies a list of predicates to apply
 to the list of results produced.</p><p>If you simply wish to check that something is deterministic, see
 the <code><a href="Test-DejaFu.html#v:autocheck">autocheck</a></code> and <code><a href="Test-DejaFu.html#v:autocheckIO">autocheckIO</a></code> functions.</p></div><div class="top"><p class="src"><a name="v:autocheck" class="def">autocheck</a> <a href="src/Test-DejaFu.html#autocheck" class="link">Source</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Eq.html#t:Eq">Eq</a> a, <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Text-Show.html#t:Show">Show</a> a)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; (<span class="keyword">forall</span> t. <a href="Test-DejaFu-Deterministic.html#t:Conc">Conc</a> t a)</td><td class="doc"><p>The computation to test</p></td></tr><tr><td class="src">-&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a> <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#t:Bool">Bool</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Automatically test a computation. In particular, look for
 deadlocks, uncaught exceptions, and multiple return values.</p><p>This uses the <code><a href="Test-DejaFu-Deterministic.html#t:Conc">Conc</a></code> monad for testing, which is an instance of
 <code>MonadConc</code>. If you need to test something which also uses
 <code>MonadIO</code>, use <code><a href="Test-DejaFu.html#v:autocheckIO">autocheckIO</a></code>.</p></div></div><div class="top"><p class="src"><a name="v:dejafu" class="def">dejafu</a> <a href="src/Test-DejaFu.html#dejafu" class="link">Source</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Eq.html#t:Eq">Eq</a> a, <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Text-Show.html#t:Show">Show</a> a)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; (<span class="keyword">forall</span> t. <a href="Test-DejaFu-Deterministic.html#t:Conc">Conc</a> t a)</td><td class="doc"><p>The computation to test</p></td></tr><tr><td class="src">-&gt; (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-String.html#t:String">String</a>, <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a)</td><td class="doc"><p>The predicate (with a name) to check</p></td></tr><tr><td class="src">-&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a> <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#t:Bool">Bool</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Check a predicate and print the result to stdout, return <code><a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#v:True">True</a></code>
 if it passes.</p></div></div><div class="top"><p class="src"><a name="v:dejafus" class="def">dejafus</a> <a href="src/Test-DejaFu.html#dejafus" class="link">Source</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Eq.html#t:Eq">Eq</a> a, <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Text-Show.html#t:Show">Show</a> a)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; (<span class="keyword">forall</span> t. <a href="Test-DejaFu-Deterministic.html#t:Conc">Conc</a> t a)</td><td class="doc"><p>The computation to test</p></td></tr><tr><td class="src">-&gt; [(<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-String.html#t:String">String</a>, <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a)]</td><td class="doc"><p>The list of predicates (with names) to check</p></td></tr><tr><td class="src">-&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a> <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#t:Bool">Bool</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Variant of <code><a href="Test-DejaFu.html#v:dejafu">dejafu</a></code> which takes a collection of predicates to
 test, returning <code><a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#v:True">True</a></code> if all pass.</p></div></div><div class="top"><p class="src"><a name="v:autocheckIO" class="def">autocheckIO</a> :: (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Eq.html#t:Eq">Eq</a> a, <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Text-Show.html#t:Show">Show</a> a) =&gt; (<span class="keyword">forall</span> t. <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a) -&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a> <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#t:Bool">Bool</a> <a href="src/Test-DejaFu.html#autocheckIO" class="link">Source</a></p><div class="doc"><p>Variant of <code><a href="Test-DejaFu.html#v:autocheck">autocheck</a></code> for computations which do <code><a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a></code>.</p></div></div><div class="top"><p class="src"><a name="v:dejafuIO" class="def">dejafuIO</a> :: (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Eq.html#t:Eq">Eq</a> a, <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Text-Show.html#t:Show">Show</a> a) =&gt; (<span class="keyword">forall</span> t. <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a) -&gt; (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-String.html#t:String">String</a>, <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a) -&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a> <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#t:Bool">Bool</a> <a href="src/Test-DejaFu.html#dejafuIO" class="link">Source</a></p><div class="doc"><p>Variant of <code><a href="Test-DejaFu.html#v:dejafu">dejafu</a></code> for computations which do <code><a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a></code>.</p></div></div><div class="top"><p class="src"><a name="v:dejafusIO" class="def">dejafusIO</a> :: (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Eq.html#t:Eq">Eq</a> a, <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Text-Show.html#t:Show">Show</a> a) =&gt; (<span class="keyword">forall</span> t. <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a) -&gt; [(<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-String.html#t:String">String</a>, <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a)] -&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a> <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#t:Bool">Bool</a> <a href="src/Test-DejaFu.html#dejafusIO" class="link">Source</a></p><div class="doc"><p>Variant of <code><a href="Test-DejaFu.html#v:dejafus">dejafus</a></code> for computations which do <code><a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a></code>.</p></div></div><h1 id="g:2">Testing under Relaxed Memory</h1><div class="doc"><p>Threads running under modern multicore processors do not behave
 as a simple interleaving of the individual thread
 actions. Processors do all sorts of complex things to increase
 speed, such as buffering writes. For concurrent programs which
 make use of non-synchronised functions (<code><a href="Test-DejaFu-Deterministic.html#v:readCRef">readCRef</a></code> coupled with
 <code><a href="Test-DejaFu-Deterministic.html#v:writeCRef">writeCRef</a></code>) different memory models may yield different results.</p><p>As an example, consider this program (modified from the
 Data.IORef documentation). Two <code>CRef</code>s are created, and two
 threads spawned to write to and read from both. Each thread
 returns the value it observes.</p><pre>example2 :: MonadConc m =&gt; m (Bool, Bool)
example2 = do
  r1 &lt;- newCRef False
  r2 &lt;- newCRef False

  x &lt;- spawn $ writeCRef r1 True &gt;&gt; readCRef r2
  y &lt;- spawn $ writeCRef r2 True &gt;&gt; readCRef r1

  (,) &lt;$&gt; readCVar x &lt;*&gt; readCVar y</pre><p>Under a sequentially consistent memory model the possible results
 are <code>(True, True)</code>, <code>(True, False)</code>, and <code>(False, True)</code>. Under
 total or partial store order, <code>(False, False)</code> is also a possible
 result, even though there is no interleaving of the threads which
 can lead to this.</p><p>We can see this by testing with different memory models:</p><pre>&gt; autocheck' SequentialConsistency example2
[pass] Never Deadlocks (checked: 6)
[pass] No Exceptions (checked: 6)
[fail] Consistent Result (checked: 5)
        (False,True) S0-------S1-----S0--S2-----S0---
        (True,False) S0-------S1-P2-----S1----S0----
        (True,True) S0-------S1--P2-----S1---S0----
        (False,True) S0-------S1---P2-----S1--S0----
        (True,False) S0-------S2-----S1-----S0----
        ...
False</pre><pre>&gt; autocheck' TotalStoreOrder example2
[pass] Never Deadlocks (checked: 303)
[pass] No Exceptions (checked: 303)
[fail] Consistent Result (checked: 302)
        (False,True) S0-------S1-----C-S0--S2-----C-S0---
        (True,False) S0-------S1-P2-----C-S1----S0----
        (True,True) S0-------S1-P2--C-S1----C-S0--S2---S0---
        (False,True) S0-------S1-P2--P1--C-C-S1--S0--S2---S0---
        (False,False) S0-------S1-P2--P1----S2---C-C-S0----
        ...
False</pre><p>Traces for non-sequentially-consistent memory models show where
 writes to <code>CRef</code>s are <em>committed</em>, which makes a write visible to
 all threads rather than just the one which performed the
 write. Only <code><a href="Test-DejaFu-Deterministic.html#v:writeCRef">writeCRef</a></code> is broken up into separate write and
 commit steps, <code><a href="Test-DejaFu-Deterministic.html#v:modifyCRef">modifyCRef</a></code> is still atomic and imposes a memory
 barrier.</p></div><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:MemType" class="def">MemType</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#MemType" class="link">Source</a></p><div class="doc"><p>The memory model to use for non-synchronised <code>CRef</code> operations.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:SequentialConsistency" class="def">SequentialConsistency</a></td><td class="doc"><p>The most intuitive model: a program behaves as a simple
 interleaving of the actions in different threads. When a <code>CRef</code>
 is written to, that write is immediately visible to all threads.</p></td></tr><tr><td class="src"><a name="v:TotalStoreOrder" class="def">TotalStoreOrder</a></td><td class="doc"><p>Each thread has a write buffer. A thread sees its writes
 immediately, but other threads will only see writes when they are
 committed, which may happen later. Writes are committed in the
 same order that they are created.</p></td></tr><tr><td class="src"><a name="v:PartialStoreOrder" class="def">PartialStoreOrder</a></td><td class="doc"><p>Each <code>CRef</code> has a write buffer. A thread sees its writes
 immediately, but other threads will only see writes when they are
 committed, which may happen later. Writes to different <code>CRef</code>s
 are not necessarily committed in the same order that they are
 created.</p></td></tr></table></div><div class="subs instances"><p id="control.i:MemType" class="caption collapser" onclick="toggleSection('i:MemType')">Instances</p><div id="section.i:MemType" class="show"><table><tr><td class="src"><a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Eq.html#t:Eq">Eq</a> <a href="Test-DejaFu.html#t:MemType">MemType</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#line-396" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Text-Read.html#t:Read">Read</a> <a href="Test-DejaFu.html#t:MemType">MemType</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#line-396" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Text-Show.html#t:Show">Show</a> <a href="Test-DejaFu.html#t:MemType">MemType</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#line-396" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="https://hackage.haskell.org/package/deepseq-1.4.1.1/docs/Control-DeepSeq.html#t:NFData">NFData</a> <a href="Test-DejaFu.html#t:MemType">MemType</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#line-398" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><a name="v:autocheck-39-" class="def">autocheck'</a> <a href="src/Test-DejaFu.html#autocheck%27" class="link">Source</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Eq.html#t:Eq">Eq</a> a, <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Text-Show.html#t:Show">Show</a> a)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="Test-DejaFu.html#t:MemType">MemType</a></td><td class="doc"><p>The memory model to use for non-synchronised <code>CRef</code> operations.</p></td></tr><tr><td class="src">-&gt; (<span class="keyword">forall</span> t. <a href="Test-DejaFu-Deterministic.html#t:Conc">Conc</a> t a)</td><td class="doc"><p>The computation to test</p></td></tr><tr><td class="src">-&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a> <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#t:Bool">Bool</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Variant of <code><a href="Test-DejaFu.html#v:autocheck">autocheck</a></code> which tests a computation under a given
 memory model.</p></div></div><div class="top"><p class="src"><a name="v:autocheckIO-39-" class="def">autocheckIO'</a> :: (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Eq.html#t:Eq">Eq</a> a, <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Text-Show.html#t:Show">Show</a> a) =&gt; <a href="Test-DejaFu.html#t:MemType">MemType</a> -&gt; (<span class="keyword">forall</span> t. <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a) -&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a> <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#t:Bool">Bool</a> <a href="src/Test-DejaFu.html#autocheckIO%27" class="link">Source</a></p><div class="doc"><p>Variant of <code><a href="Test-DejaFu.html#v:autocheck-39-">autocheck'</a></code> for computations which do <code><a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a></code>.</p></div></div><div class="top"><p class="src"><a name="v:dejafu-39-" class="def">dejafu'</a> <a href="src/Test-DejaFu.html#dejafu%27" class="link">Source</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Eq.html#t:Eq">Eq</a> a, <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Text-Show.html#t:Show">Show</a> a)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="Test-DejaFu.html#t:MemType">MemType</a></td><td class="doc"><p>The memory model to use for non-synchronised <code>CRef</code> operations.</p></td></tr><tr><td class="src">-&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Int.html#t:Int">Int</a></td><td class="doc"><p>The maximum number of pre-emptions to allow in a single
 execution</p></td></tr><tr><td class="src">-&gt; (<span class="keyword">forall</span> t. <a href="Test-DejaFu-Deterministic.html#t:Conc">Conc</a> t a)</td><td class="doc"><p>The computation to test</p></td></tr><tr><td class="src">-&gt; (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-String.html#t:String">String</a>, <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a)</td><td class="doc"><p>The predicate (with a name) to check</p></td></tr><tr><td class="src">-&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a> <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#t:Bool">Bool</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Variant of <code><a href="Test-DejaFu.html#v:dejafu-39-">dejafu'</a></code> which takes a memory model and pre-emption
 bound.</p><p>Pre-emption bounding is used to filter the large number of possible
 schedules, and can be iteratively increased for further coverage
 guarantees. Empirical studies (<em>Concurrency Testing Using Schedule Bounding: an Empirical Study</em>,
 P. Thompson, A. Donaldson, and A. Betts) have found that many
 concurrency bugs can be exhibited with as few as two threads and
 two pre-emptions, which is what <code><a href="Test-DejaFu.html#v:dejafus">dejafus</a></code> uses.</p><p><strong>Warning:</strong> Using a larger pre-emption bound will almost certainly
 significantly increase the time taken to test!</p></div></div><div class="top"><p class="src"><a name="v:dejafus-39-" class="def">dejafus'</a> <a href="src/Test-DejaFu.html#dejafus%27" class="link">Source</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Eq.html#t:Eq">Eq</a> a, <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Text-Show.html#t:Show">Show</a> a)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="Test-DejaFu.html#t:MemType">MemType</a></td><td class="doc"><p>The memory model to use for non-synchronised <code>CRef</code> operations.</p></td></tr><tr><td class="src">-&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Int.html#t:Int">Int</a></td><td class="doc"><p>The maximum number of pre-emptions to allow in a single
 execution</p></td></tr><tr><td class="src">-&gt; (<span class="keyword">forall</span> t. <a href="Test-DejaFu-Deterministic.html#t:Conc">Conc</a> t a)</td><td class="doc"><p>The computation to test</p></td></tr><tr><td class="src">-&gt; [(<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-String.html#t:String">String</a>, <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a)]</td><td class="doc"><p>The list of predicates (with names) to check</p></td></tr><tr><td class="src">-&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a> <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#t:Bool">Bool</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Variant of <code><a href="Test-DejaFu.html#v:dejafus">dejafus</a></code> which takes a memory model and pre-emption
 bound.</p></div></div><div class="top"><p class="src"><a name="v:dejafuIO-39-" class="def">dejafuIO'</a> :: (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Eq.html#t:Eq">Eq</a> a, <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Text-Show.html#t:Show">Show</a> a) =&gt; <a href="Test-DejaFu.html#t:MemType">MemType</a> -&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Int.html#t:Int">Int</a> -&gt; (<span class="keyword">forall</span> t. <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a) -&gt; (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-String.html#t:String">String</a>, <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a) -&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a> <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#t:Bool">Bool</a> <a href="src/Test-DejaFu.html#dejafuIO%27" class="link">Source</a></p><div class="doc"><p>Variant of <code><a href="Test-DejaFu.html#v:dejafu-39-">dejafu'</a></code> for computations which do <code><a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a></code>.</p></div></div><div class="top"><p class="src"><a name="v:dejafusIO-39-" class="def">dejafusIO'</a> :: (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Eq.html#t:Eq">Eq</a> a, <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Text-Show.html#t:Show">Show</a> a) =&gt; <a href="Test-DejaFu.html#t:MemType">MemType</a> -&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Int.html#t:Int">Int</a> -&gt; (<span class="keyword">forall</span> t. <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a) -&gt; [(<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-String.html#t:String">String</a>, <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a)] -&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a> <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#t:Bool">Bool</a> <a href="src/Test-DejaFu.html#dejafusIO%27" class="link">Source</a></p><div class="doc"><p>Variant of <code><a href="Test-DejaFu.html#v:dejafus-39-">dejafus'</a></code> for computations which do <code><a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a></code>.</p></div></div><h1 id="g:3">Results</h1><div class="doc"><p>The results of a test can be pretty-printed to the console, as
 with the above functions, or used in their original, much richer,
 form for debugging purposes. These functions provide full access
 to this data type which, most usefully, contains a detailed trace
 of execution, showing what each thread did at each point.</p></div><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:Result" class="def">Result</a> a <a href="src/Test-DejaFu.html#Result" class="link">Source</a></p><div class="doc"><p>The results of a test, including the number of cases checked to
 determine the final boolean outcome.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:Result" class="def">Result</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:_pass" class="def">_pass</a> :: <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#t:Bool">Bool</a></dt><dd class="doc"><p>Whether the test passed or not.</p></dd><dt class="src"><a name="v:_casesChecked" class="def">_casesChecked</a> :: <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Int.html#t:Int">Int</a></dt><dd class="doc"><p>The number of cases checked.</p></dd><dt class="src"><a name="v:_failures" class="def">_failures</a> :: [(<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Either.html#t:Either">Either</a> <a href="Test-DejaFu.html#t:Failure">Failure</a> a, <a href="Test-DejaFu-Deterministic.html#t:Trace">Trace</a>)]</dt><dd class="doc"><p>The failing cases, if any.</p></dd></dl><div class="clear"></div></div></td></tr></table></div><div class="subs instances"><p id="control.i:Result" class="caption collapser" onclick="toggleSection('i:Result')">Instances</p><div id="section.i:Result" class="show"><table><tr><td class="src"><a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Functor.html#t:Functor">Functor</a> <a href="Test-DejaFu.html#t:Result">Result</a> <a href="src/Test-DejaFu.html#line-338" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Foldable.html#t:Foldable">Foldable</a> <a href="Test-DejaFu.html#t:Result">Result</a> <a href="src/Test-DejaFu.html#line-341" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Eq.html#t:Eq">Eq</a> a =&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Eq.html#t:Eq">Eq</a> (<a href="Test-DejaFu.html#t:Result">Result</a> a) <a href="src/Test-DejaFu.html#line-333" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Text-Show.html#t:Show">Show</a> a =&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Text-Show.html#t:Show">Show</a> (<a href="Test-DejaFu.html#t:Result">Result</a> a) <a href="src/Test-DejaFu.html#line-333" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="https://hackage.haskell.org/package/deepseq-1.4.1.1/docs/Control-DeepSeq.html#t:NFData">NFData</a> a =&gt; <a href="https://hackage.haskell.org/package/deepseq-1.4.1.1/docs/Control-DeepSeq.html#t:NFData">NFData</a> (<a href="Test-DejaFu.html#t:Result">Result</a> a) <a href="src/Test-DejaFu.html#line-335" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:Failure" class="def">Failure</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#Failure" class="link">Source</a></p><div class="doc"><p>An indication of how a concurrent computation failed.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:InternalError" class="def">InternalError</a></td><td class="doc"><p>Will be raised if the scheduler does something bad. This should
 never arise unless you write your own, faulty, scheduler! If it
 does, please file a bug report.</p></td></tr><tr><td class="src"><a name="v:Deadlock" class="def">Deadlock</a></td><td class="doc"><p>The computation became blocked indefinitely on <code>CVar</code>s.</p></td></tr><tr><td class="src"><a name="v:STMDeadlock" class="def">STMDeadlock</a></td><td class="doc"><p>The computation became blocked indefinitely on <code>CTVar</code>s.</p></td></tr><tr><td class="src"><a name="v:UncaughtException" class="def">UncaughtException</a></td><td class="doc"><p>An uncaught exception bubbled to the top of the computation.</p></td></tr></table></div><div class="subs instances"><p id="control.i:Failure" class="caption collapser" onclick="toggleSection('i:Failure')">Instances</p><div id="section.i:Failure" class="show"><table><tr><td class="src"><a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Eq.html#t:Eq">Eq</a> <a href="Test-DejaFu.html#t:Failure">Failure</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#line-364" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Text-Show.html#t:Show">Show</a> <a href="Test-DejaFu.html#t:Failure">Failure</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#line-364" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="https://hackage.haskell.org/package/deepseq-1.4.1.1/docs/Control-DeepSeq.html#t:NFData">NFData</a> <a href="Test-DejaFu.html#t:Failure">Failure</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#line-366" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><a name="v:runTest" class="def">runTest</a> <a href="src/Test-DejaFu.html#runTest" class="link">Source</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a</td><td class="doc"><p>The predicate to check</p></td></tr><tr><td class="src">-&gt; (<span class="keyword">forall</span> t. <a href="Test-DejaFu-Deterministic.html#t:Conc">Conc</a> t a)</td><td class="doc"><p>The computation to test</p></td></tr><tr><td class="src">-&gt; <a href="Test-DejaFu.html#t:Result">Result</a> a</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Run a predicate over all executions with two or fewer
 pre-emptions.</p></div></div><div class="top"><p class="src"><a name="v:runTest-39-" class="def">runTest'</a> <a href="src/Test-DejaFu.html#runTest%27" class="link">Source</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Test-DejaFu.html#t:MemType">MemType</a></td><td class="doc"><p>The memory model to use for non-synchronised <code>CRef</code> operations.</p></td></tr><tr><td class="src">-&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Int.html#t:Int">Int</a></td><td class="doc"><p>The maximum number of pre-emptions to allow in a single
 execution</p></td></tr><tr><td class="src">-&gt; <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a</td><td class="doc"><p>The predicate to check</p></td></tr><tr><td class="src">-&gt; (<span class="keyword">forall</span> t. <a href="Test-DejaFu-Deterministic.html#t:Conc">Conc</a> t a)</td><td class="doc"><p>The computation to test</p></td></tr><tr><td class="src">-&gt; <a href="Test-DejaFu.html#t:Result">Result</a> a</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Variant of <code><a href="Test-DejaFu.html#v:runTest">runTest</a></code> which takes a memory model and pre-emption
 bound.</p></div></div><div class="top"><p class="src"><a name="v:runTestIO" class="def">runTestIO</a> :: <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a -&gt; (<span class="keyword">forall</span> t. <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a) -&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a> (<a href="Test-DejaFu.html#t:Result">Result</a> a) <a href="src/Test-DejaFu.html#runTestIO" class="link">Source</a></p><div class="doc"><p>Variant of <code><a href="Test-DejaFu.html#v:runTest">runTest</a></code> for computations which do <code><a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a></code>.</p></div></div><div class="top"><p class="src"><a name="v:runTestIO-39-" class="def">runTestIO'</a> :: <a href="Test-DejaFu.html#t:MemType">MemType</a> -&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Int.html#t:Int">Int</a> -&gt; <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a -&gt; (<span class="keyword">forall</span> t. <a href="Test-DejaFu-Deterministic-IO.html#t:ConcIO">ConcIO</a> t a) -&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a> (<a href="Test-DejaFu.html#t:Result">Result</a> a) <a href="src/Test-DejaFu.html#runTestIO%27" class="link">Source</a></p><div class="doc"><p>Variant of <code><a href="Test-DejaFu.html#v:runTest-39-">runTest'</a></code> for computations which do <code><a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/System-IO.html#t:IO">IO</a></code>.</p></div></div><h1 id="g:4">Predicates</h1><div class="doc"><p>Predicates evaluate a list of results of execution and decide
 whether some test case has passed or failed. They can be lazy and
 make use of short-circuit evaluation to avoid needing to examine
 the entire list of results, and can check any property which can
 be defined for the return type of your monadic action.</p><p>A collection of common predicates are provided, along with the
 helper functions <code><a href="Test-DejaFu.html#v:alwaysTrue">alwaysTrue</a></code>, <code><a href="Test-DejaFu.html#v:alwaysTrue2">alwaysTrue2</a></code> and <code><a href="Test-DejaFu.html#v:somewhereTrue">somewhereTrue</a></code>
 to lfit predicates over a single result to over a collection of
 results.</p></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:Predicate" class="def">Predicate</a> a = [(<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Either.html#t:Either">Either</a> <a href="Test-DejaFu.html#t:Failure">Failure</a> a, <a href="Test-DejaFu-Deterministic.html#t:Trace">Trace</a>)] -&gt; <a href="Test-DejaFu.html#t:Result">Result</a> a <a href="src/Test-DejaFu.html#Predicate" class="link">Source</a></p><div class="doc"><p>A <code>Predicate</code> is a function which collapses a list of results
 into a <code><a href="Test-DejaFu.html#t:Result">Result</a></code>.</p></div></div><div class="top"><p class="src"><a name="v:deadlocksNever" class="def">deadlocksNever</a> :: <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a <a href="src/Test-DejaFu.html#deadlocksNever" class="link">Source</a></p><div class="doc"><p>Check that a computation never deadlocks.</p></div></div><div class="top"><p class="src"><a name="v:deadlocksAlways" class="def">deadlocksAlways</a> :: <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a <a href="src/Test-DejaFu.html#deadlocksAlways" class="link">Source</a></p><div class="doc"><p>Check that a computation always deadlocks.</p></div></div><div class="top"><p class="src"><a name="v:deadlocksSometimes" class="def">deadlocksSometimes</a> :: <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a <a href="src/Test-DejaFu.html#deadlocksSometimes" class="link">Source</a></p><div class="doc"><p>Check that a computation deadlocks at least once.</p></div></div><div class="top"><p class="src"><a name="v:exceptionsNever" class="def">exceptionsNever</a> :: <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a <a href="src/Test-DejaFu.html#exceptionsNever" class="link">Source</a></p><div class="doc"><p>Check that a computation never fails with an uncaught exception.</p></div></div><div class="top"><p class="src"><a name="v:exceptionsAlways" class="def">exceptionsAlways</a> :: <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a <a href="src/Test-DejaFu.html#exceptionsAlways" class="link">Source</a></p><div class="doc"><p>Check that a computation always fails with an uncaught exception.</p></div></div><div class="top"><p class="src"><a name="v:exceptionsSometimes" class="def">exceptionsSometimes</a> :: <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a <a href="src/Test-DejaFu.html#exceptionsSometimes" class="link">Source</a></p><div class="doc"><p>Check that a computation fails with an uncaught exception at least once.</p></div></div><div class="top"><p class="src"><a name="v:alwaysSame" class="def">alwaysSame</a> :: <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Eq.html#t:Eq">Eq</a> a =&gt; <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a <a href="src/Test-DejaFu.html#alwaysSame" class="link">Source</a></p><div class="doc"><p>Check that the result of a computation is always the same. In
 particular this means either: (a) it always fails in the same way,
 or (b) it never fails and the values returned are all equal.</p></div></div><div class="top"><p class="src"><a name="v:notAlwaysSame" class="def">notAlwaysSame</a> :: <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Eq.html#t:Eq">Eq</a> a =&gt; <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a <a href="src/Test-DejaFu.html#notAlwaysSame" class="link">Source</a></p><div class="doc"><p>Check that the result of a computation is not always the same.</p></div></div><div class="top"><p class="src"><a name="v:alwaysTrue" class="def">alwaysTrue</a> :: (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Either.html#t:Either">Either</a> <a href="Test-DejaFu.html#t:Failure">Failure</a> a -&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#t:Bool">Bool</a>) -&gt; <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a <a href="src/Test-DejaFu.html#alwaysTrue" class="link">Source</a></p><div class="doc"><p>Check that the result of a unary boolean predicate is always
 true.</p></div></div><div class="top"><p class="src"><a name="v:alwaysTrue2" class="def">alwaysTrue2</a> :: (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Either.html#t:Either">Either</a> <a href="Test-DejaFu.html#t:Failure">Failure</a> a -&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Either.html#t:Either">Either</a> <a href="Test-DejaFu.html#t:Failure">Failure</a> a -&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#t:Bool">Bool</a>) -&gt; <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a <a href="src/Test-DejaFu.html#alwaysTrue2" class="link">Source</a></p><div class="doc"><p>Check that the result of a binary boolean predicate is true
 between all pairs of results. Only properties which are transitive
 and symmetric should be used here.</p><p>If the predicate fails, <em>both</em> (result,trace) tuples will be added
 to the failures list.</p></div></div><div class="top"><p class="src"><a name="v:somewhereTrue" class="def">somewhereTrue</a> :: (<a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Either.html#t:Either">Either</a> <a href="Test-DejaFu.html#t:Failure">Failure</a> a -&gt; <a href="https://hackage.haskell.org/package/base-4.8.0.0/docs/Data-Bool.html#t:Bool">Bool</a>) -&gt; <a href="Test-DejaFu.html#t:Predicate">Predicate</a> a <a href="src/Test-DejaFu.html#somewhereTrue" class="link">Source</a></p><div class="doc"><p>Check that the result of a unary boolean predicate is true at
 least once.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.16.0</p></div></body></html>