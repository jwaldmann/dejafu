<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Test.DejaFu.Deterministic.Internal.Common</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Test-DejaFu-Deterministic-Internal-Common.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Test-DejaFu-Deterministic-Internal-Common.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">dejafu-0.2.0.0: Overloadable primitives for testable, potentially non-deterministic, concurrency.</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Test.DejaFu.Deterministic.Internal.Common</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">The <code>Conc</code> Monad</a></li><li><a href="#g:2">Primitive Actions</a></li><li><a href="#g:3">Identifiers</a></li><li><a href="#g:4">Scheduling &amp; Traces</a></li><li><a href="#g:5">Failures</a></li><li><a href="#g:6">Memory Models</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Common types and utility functions for deterministic execution of
 <code>MonadConc</code> implementations.</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">newtype</span> <a href="#t:M">M</a> n r s a = <a href="#v:M">M</a> {<ul class="subs"><li><a href="#v:runM">runM</a> :: (a -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s) -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s</li></ul>}</li><li class="src short"><span class="keyword">newtype</span> <a href="#t:CVar">CVar</a> r a = <a href="#v:CVar">CVar</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a>, r (<a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Maybe.html#t:Maybe">Maybe</a> a))</li><li class="src short"><span class="keyword">newtype</span> <a href="#t:CRef">CRef</a> r a = <a href="#v:CRef">CRef</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a>, r (<a href="https://hackage.haskell.org/package/containers-0.5.6.2/docs/Data-IntMap-Strict.html#t:IntMap">IntMap</a> a, <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#t:Integer">Integer</a>, a))</li><li class="src short"><span class="keyword">newtype</span> <a href="#t:Ticket">Ticket</a> a = <a href="#v:Ticket">Ticket</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a>, <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#t:Integer">Integer</a>, a)</li><li class="src short"><span class="keyword">type</span> <a href="#t:Fixed">Fixed</a> n r s = <a href="Test-DejaFu-Internal.html#t:Ref">Ref</a> n r (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:M">M</a> n r s)</li><li class="src short"><a href="#v:cont">cont</a> :: ((a -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s) -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s) -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:M">M</a> n r s a</li><li class="src short"><a href="#v:runCont">runCont</a> :: <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:M">M</a> n r s a -&gt; (a -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s) -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s</li><li class="src short"><span class="keyword">data</span> <a href="#t:Action">Action</a> n r s<ul class="subs"><li>= <a href="#v:AFork">AFork</a> ((<span class="keyword">forall</span> b. <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:M">M</a> n r s b -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:M">M</a> n r s b) -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s) (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a> -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</li><li>| <a href="#v:AMyTId">AMyTId</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a> -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</li><li>| <span class="keyword">forall</span> a . <a href="#v:ANewVar">ANewVar</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVar">CVar</a> r a -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</li><li>| <span class="keyword">forall</span> a . <a href="#v:APutVar">APutVar</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVar">CVar</a> r a) a (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</li><li>| <span class="keyword">forall</span> a . <a href="#v:ATryPutVar">ATryPutVar</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVar">CVar</a> r a) a (<a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Bool.html#t:Bool">Bool</a> -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</li><li>| <span class="keyword">forall</span> a . <a href="#v:AReadVar">AReadVar</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVar">CVar</a> r a) (a -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</li><li>| <span class="keyword">forall</span> a . <a href="#v:ATakeVar">ATakeVar</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVar">CVar</a> r a) (a -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</li><li>| <span class="keyword">forall</span> a . <a href="#v:ATryTakeVar">ATryTakeVar</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVar">CVar</a> r a) (<a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Maybe.html#t:Maybe">Maybe</a> a -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</li><li>| <span class="keyword">forall</span> a . <a href="#v:ANewRef">ANewRef</a> a (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRef">CRef</a> r a -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</li><li>| <span class="keyword">forall</span> a . <a href="#v:AReadRef">AReadRef</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRef">CRef</a> r a) (a -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</li><li>| <span class="keyword">forall</span> a . <a href="#v:AReadRefCas">AReadRefCas</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRef">CRef</a> r a) (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Ticket">Ticket</a> a -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</li><li>| <span class="keyword">forall</span> a . <a href="#v:APeekTicket">APeekTicket</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Ticket">Ticket</a> a) (a -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</li><li>| <span class="keyword">forall</span> a b . <a href="#v:AModRef">AModRef</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRef">CRef</a> r a) (a -&gt; (a, b)) (b -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</li><li>| <span class="keyword">forall</span> a b . <a href="#v:AModRefCas">AModRefCas</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRef">CRef</a> r a) (a -&gt; (a, b)) (b -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</li><li>| <span class="keyword">forall</span> a . <a href="#v:AWriteRef">AWriteRef</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRef">CRef</a> r a) a (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</li><li>| <span class="keyword">forall</span> a . <a href="#v:ACasRef">ACasRef</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRef">CRef</a> r a) (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Ticket">Ticket</a> a) a ((<a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Bool.html#t:Bool">Bool</a>, <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Ticket">Ticket</a> a) -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</li><li>| <span class="keyword">forall</span> e . <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Exception-Base.html#t:Exception">Exception</a> e =&gt; <a href="#v:AThrow">AThrow</a> e</li><li>| <span class="keyword">forall</span> e . <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Exception-Base.html#t:Exception">Exception</a> e =&gt; <a href="#v:AThrowTo">AThrowTo</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a> e (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</li><li>| <span class="keyword">forall</span> a e . <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Exception-Base.html#t:Exception">Exception</a> e =&gt; <a href="#v:ACatching">ACatching</a> (e -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:M">M</a> n r s a) (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:M">M</a> n r s a) (a -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</li><li>| <a href="#v:APopCatching">APopCatching</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</li><li>| <span class="keyword">forall</span> a . <a href="#v:AMasking">AMasking</a> <a href="Test-DejaFu-Deterministic.html#t:MaskingState">MaskingState</a> ((<span class="keyword">forall</span> b. <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:M">M</a> n r s b -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:M">M</a> n r s b) -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:M">M</a> n r s a) (a -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</li><li>| <a href="#v:AResetMask">AResetMask</a> <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Bool.html#t:Bool">Bool</a> <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Bool.html#t:Bool">Bool</a> <a href="Test-DejaFu-Deterministic.html#t:MaskingState">MaskingState</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</li><li>| <a href="#v:AKnowsAbout">AKnowsAbout</a> (<a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Either.html#t:Either">Either</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a> <a href="Test-DejaFu-STM-Internal.html#t:CTVarId">CTVarId</a>) (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</li><li>| <a href="#v:AForgets">AForgets</a> (<a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Either.html#t:Either">Either</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a> <a href="Test-DejaFu-STM-Internal.html#t:CTVarId">CTVarId</a>) (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</li><li>| <a href="#v:AAllKnown">AAllKnown</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</li><li>| <span class="keyword">forall</span> a . <a href="#v:AAtom">AAtom</a> (s a) (a -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</li><li>| <a href="#v:ALift">ALift</a> (n (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s))</li><li>| <a href="#v:AYield">AYield</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</li><li>| <a href="#v:AReturn">AReturn</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</li><li>| <a href="#v:ACommit">ACommit</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></li><li>| <a href="#v:AStop">AStop</a></li></ul></li><li class="src short"><span class="keyword">type</span> <a href="#t:ThreadId">ThreadId</a> = <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Int.html#t:Int">Int</a></li><li class="src short"><span class="keyword">type</span> <a href="#t:CVarId">CVarId</a> = <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Int.html#t:Int">Int</a></li><li class="src short"><span class="keyword">type</span> <a href="#t:CRefId">CRefId</a> = <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Int.html#t:Int">Int</a></li><li class="src short"><span class="keyword">data</span> <a href="#t:IdSource">IdSource</a> = <a href="#v:Id">Id</a> {<ul class="subs"><li><a href="#v:_nextCRId">_nextCRId</a> :: <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></li><li><a href="#v:_nextCVId">_nextCVId</a> :: <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a></li><li><a href="#v:_nextCTVId">_nextCTVId</a> :: <a href="Test-DejaFu-STM-Internal.html#t:CTVarId">CTVarId</a></li><li><a href="#v:_nextTId">_nextTId</a> :: <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a></li></ul>}</li><li class="src short"><a href="#v:nextCRId">nextCRId</a> :: <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:IdSource">IdSource</a> -&gt; (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:IdSource">IdSource</a>, <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a>)</li><li class="src short"><a href="#v:nextCVId">nextCVId</a> :: <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:IdSource">IdSource</a> -&gt; (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:IdSource">IdSource</a>, <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a>)</li><li class="src short"><a href="#v:nextCTVId">nextCTVId</a> :: <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:IdSource">IdSource</a> -&gt; (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:IdSource">IdSource</a>, <a href="Test-DejaFu-STM-Internal.html#t:CTVarId">CTVarId</a>)</li><li class="src short"><a href="#v:nextTId">nextTId</a> :: <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:IdSource">IdSource</a> -&gt; (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:IdSource">IdSource</a>, <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a>)</li><li class="src short"><a href="#v:initialIdSource">initialIdSource</a> :: <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:IdSource">IdSource</a></li><li class="src short"><span class="keyword">type</span> <a href="#t:Scheduler">Scheduler</a> s = s -&gt; <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Maybe.html#t:Maybe">Maybe</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a>, <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadAction">ThreadAction</a>) -&gt; <a href="Data-List-Extra.html#t:NonEmpty">NonEmpty</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a>, <a href="Data-List-Extra.html#t:NonEmpty">NonEmpty</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Lookahead">Lookahead</a>) -&gt; (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a>, s)</li><li class="src short"><span class="keyword">type</span> <a href="#t:Trace">Trace</a> = [(<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Decision">Decision</a>, [(<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Decision">Decision</a>, <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Lookahead">Lookahead</a>)], <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadAction">ThreadAction</a>)]</li><li class="src short"><span class="keyword">type</span> <a href="#t:Trace-39-">Trace'</a> = [(<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Decision">Decision</a>, [(<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Decision">Decision</a>, <a href="Data-List-Extra.html#t:NonEmpty">NonEmpty</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Lookahead">Lookahead</a>)], <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadAction">ThreadAction</a>)]</li><li class="src short"><a href="#v:toTrace">toTrace</a> :: <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Trace-39-">Trace'</a> -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Trace">Trace</a></li><li class="src short"><a href="#v:showTrace">showTrace</a> :: <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Trace">Trace</a> -&gt; <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-String.html#t:String">String</a></li><li class="src short"><span class="keyword">data</span> <a href="#t:Decision">Decision</a><ul class="subs"><li>= <a href="#v:Start">Start</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a></li><li>| <a href="#v:Continue">Continue</a></li><li>| <a href="#v:SwitchTo">SwitchTo</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a></li><li>| <a href="#v:Commit">Commit</a></li></ul></li><li class="src short"><span class="keyword">data</span> <a href="#t:ThreadAction">ThreadAction</a><ul class="subs"><li>= <a href="#v:Fork">Fork</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a></li><li>| <a href="#v:MyThreadId">MyThreadId</a></li><li>| <a href="#v:Yield">Yield</a></li><li>| <a href="#v:NewVar">NewVar</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a></li><li>| <a href="#v:PutVar">PutVar</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a> [<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a>]</li><li>| <a href="#v:BlockedPutVar">BlockedPutVar</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a></li><li>| <a href="#v:TryPutVar">TryPutVar</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a> <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Bool.html#t:Bool">Bool</a> [<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a>]</li><li>| <a href="#v:ReadVar">ReadVar</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a></li><li>| <a href="#v:BlockedReadVar">BlockedReadVar</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a></li><li>| <a href="#v:TakeVar">TakeVar</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a> [<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a>]</li><li>| <a href="#v:BlockedTakeVar">BlockedTakeVar</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a></li><li>| <a href="#v:TryTakeVar">TryTakeVar</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a> <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Bool.html#t:Bool">Bool</a> [<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a>]</li><li>| <a href="#v:NewRef">NewRef</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></li><li>| <a href="#v:ReadRef">ReadRef</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></li><li>| <a href="#v:ReadRefCas">ReadRefCas</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></li><li>| <a href="#v:PeekTicket">PeekTicket</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></li><li>| <a href="#v:ModRef">ModRef</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></li><li>| <a href="#v:ModRefCas">ModRefCas</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></li><li>| <a href="#v:WriteRef">WriteRef</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></li><li>| <a href="#v:CasRef">CasRef</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a> <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Bool.html#t:Bool">Bool</a></li><li>| <a href="#v:CommitRef">CommitRef</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></li><li>| <a href="#v:STM">STM</a> [<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a>]</li><li>| <a href="#v:FreshSTM">FreshSTM</a></li><li>| <a href="#v:BlockedSTM">BlockedSTM</a></li><li>| <a href="#v:Catching">Catching</a></li><li>| <a href="#v:PopCatching">PopCatching</a></li><li>| <a href="#v:Throw">Throw</a></li><li>| <a href="#v:ThrowTo">ThrowTo</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a></li><li>| <a href="#v:BlockedThrowTo">BlockedThrowTo</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a></li><li>| <a href="#v:Killed">Killed</a></li><li>| <a href="#v:SetMasking">SetMasking</a> <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Bool.html#t:Bool">Bool</a> <a href="Test-DejaFu-Deterministic.html#t:MaskingState">MaskingState</a></li><li>| <a href="#v:ResetMasking">ResetMasking</a> <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Bool.html#t:Bool">Bool</a> <a href="Test-DejaFu-Deterministic.html#t:MaskingState">MaskingState</a></li><li>| <a href="#v:Lift">Lift</a></li><li>| <a href="#v:Return">Return</a></li><li>| <a href="#v:KnowsAbout">KnowsAbout</a></li><li>| <a href="#v:Forgets">Forgets</a></li><li>| <a href="#v:AllKnown">AllKnown</a></li><li>| <a href="#v:Stop">Stop</a></li></ul></li><li class="src short"><span class="keyword">data</span> <a href="#t:Lookahead">Lookahead</a><ul class="subs"><li>= <a href="#v:WillFork">WillFork</a></li><li>| <a href="#v:WillMyThreadId">WillMyThreadId</a></li><li>| <a href="#v:WillYield">WillYield</a></li><li>| <a href="#v:WillNewVar">WillNewVar</a></li><li>| <a href="#v:WillPutVar">WillPutVar</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a></li><li>| <a href="#v:WillTryPutVar">WillTryPutVar</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a></li><li>| <a href="#v:WillReadVar">WillReadVar</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a></li><li>| <a href="#v:WillTakeVar">WillTakeVar</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a></li><li>| <a href="#v:WillTryTakeVar">WillTryTakeVar</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a></li><li>| <a href="#v:WillNewRef">WillNewRef</a></li><li>| <a href="#v:WillReadRef">WillReadRef</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></li><li>| <a href="#v:WillPeekTicket">WillPeekTicket</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></li><li>| <a href="#v:WillReadRefCas">WillReadRefCas</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></li><li>| <a href="#v:WillModRef">WillModRef</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></li><li>| <a href="#v:WillModRefCas">WillModRefCas</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></li><li>| <a href="#v:WillWriteRef">WillWriteRef</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></li><li>| <a href="#v:WillCasRef">WillCasRef</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></li><li>| <a href="#v:WillCommitRef">WillCommitRef</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></li><li>| <a href="#v:WillSTM">WillSTM</a></li><li>| <a href="#v:WillCatching">WillCatching</a></li><li>| <a href="#v:WillPopCatching">WillPopCatching</a></li><li>| <a href="#v:WillThrow">WillThrow</a></li><li>| <a href="#v:WillThrowTo">WillThrowTo</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a></li><li>| <a href="#v:WillSetMasking">WillSetMasking</a> <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Bool.html#t:Bool">Bool</a> <a href="Test-DejaFu-Deterministic.html#t:MaskingState">MaskingState</a></li><li>| <a href="#v:WillResetMasking">WillResetMasking</a> <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Bool.html#t:Bool">Bool</a> <a href="Test-DejaFu-Deterministic.html#t:MaskingState">MaskingState</a></li><li>| <a href="#v:WillLift">WillLift</a></li><li>| <a href="#v:WillReturn">WillReturn</a></li><li>| <a href="#v:WillKnowsAbout">WillKnowsAbout</a></li><li>| <a href="#v:WillForgets">WillForgets</a></li><li>| <a href="#v:WillAllKnown">WillAllKnown</a></li><li>| <a href="#v:WillStop">WillStop</a></li></ul></li><li class="src short"><a href="#v:lookahead">lookahead</a> :: <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s -&gt; <a href="Data-List-Extra.html#t:NonEmpty">NonEmpty</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Lookahead">Lookahead</a></li><li class="src short"><span class="keyword">data</span> <a href="#t:ActionType">ActionType</a><ul class="subs"><li>= <a href="#v:UnsynchronisedRead">UnsynchronisedRead</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></li><li>| <a href="#v:UnsynchronisedWrite">UnsynchronisedWrite</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></li><li>| <a href="#v:UnsynchronisedOther">UnsynchronisedOther</a></li><li>| <a href="#v:PartiallySynchronisedCommit">PartiallySynchronisedCommit</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></li><li>| <a href="#v:PartiallySynchronisedWrite">PartiallySynchronisedWrite</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></li><li>| <a href="#v:PartiallySynchronisedModify">PartiallySynchronisedModify</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></li><li>| <a href="#v:SynchronisedModify">SynchronisedModify</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></li><li>| <a href="#v:SynchronisedRead">SynchronisedRead</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a></li><li>| <a href="#v:SynchronisedWrite">SynchronisedWrite</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a></li><li>| <a href="#v:SynchronisedOther">SynchronisedOther</a></li></ul></li><li class="src short"><a href="#v:isBarrier">isBarrier</a> :: <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ActionType">ActionType</a> -&gt; <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Bool.html#t:Bool">Bool</a></li><li class="src short"><a href="#v:synchronises">synchronises</a> :: <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ActionType">ActionType</a> -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a> -&gt; <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Bool.html#t:Bool">Bool</a></li><li class="src short"><a href="#v:crefOf">crefOf</a> :: <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ActionType">ActionType</a> -&gt; <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></li><li class="src short"><a href="#v:cvarOf">cvarOf</a> :: <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ActionType">ActionType</a> -&gt; <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a></li><li class="src short"><a href="#v:simplify">simplify</a> :: <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadAction">ThreadAction</a> -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ActionType">ActionType</a></li><li class="src short"><a href="#v:simplify-39-">simplify'</a> :: <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Lookahead">Lookahead</a> -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ActionType">ActionType</a></li><li class="src short"><span class="keyword">data</span> <a href="#t:Failure">Failure</a><ul class="subs"><li>= <a href="#v:InternalError">InternalError</a></li><li>| <a href="#v:Deadlock">Deadlock</a></li><li>| <a href="#v:STMDeadlock">STMDeadlock</a></li><li>| <a href="#v:UncaughtException">UncaughtException</a></li></ul></li><li class="src short"><a href="#v:showFail">showFail</a> :: <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Failure">Failure</a> -&gt; <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-String.html#t:String">String</a></li><li class="src short"><span class="keyword">data</span> <a href="#t:MemType">MemType</a><ul class="subs"><li>= <a href="#v:SequentialConsistency">SequentialConsistency</a></li><li>| <a href="#v:TotalStoreOrder">TotalStoreOrder</a></li><li>| <a href="#v:PartialStoreOrder">PartialStoreOrder</a></li></ul></li></ul></div><div id="interface"><h1 id="g:1">The <code>Conc</code> Monad</h1><div class="top"><p class="src"><span class="keyword">newtype</span> <a name="t:M" class="def">M</a> n r s a <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#M" class="link">Source</a></p><div class="doc"><p>The underlying monad is based on continuations over Actions.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:M" class="def">M</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:runM" class="def">runM</a> :: (a -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s) -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s</dt><dd class="doc empty">&nbsp;</dd></dl><div class="clear"></div></div></td></tr></table></div><div class="subs instances"><p id="control.i:M" class="caption collapser" onclick="toggleSection('i:M')">Instances</p><div id="section.i:M" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Monad.html#t:Monad">Monad</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:M">M</a> n r s)</span> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#line-33" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Functor.html#t:Functor">Functor</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:M">M</a> n r s)</span> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#line-26" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Applicative.html#t:Applicative">Applicative</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:M">M</a> n r s)</span> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#line-29" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">newtype</span> <a name="t:CVar" class="def">CVar</a> r a <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#CVar" class="link">Source</a></p><div class="doc"><p>The concurrent variable type used with the <code>Conc</code> monad. One
 notable difference between these and <code>MVar</code>s is that <code>MVar</code>s are
 single-wakeup, and wake up in a FIFO order. Writing to a <code>CVar</code>
 wakes up all threads blocked on reading it, and it is up to the
 scheduler which one runs next. Taking from a <code>CVar</code> behaves
 analogously.</p><p><code>CVar</code>s are represented as a unique numeric identifier, and a
 reference containing a Maybe value.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:CVar" class="def">CVar</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a>, r (<a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Maybe.html#t:Maybe">Maybe</a> a))</td><td class="doc empty">&nbsp;</td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">newtype</span> <a name="t:CRef" class="def">CRef</a> r a <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#CRef" class="link">Source</a></p><div class="doc"><p>The mutable non-blocking reference type. These are like <code>IORef</code>s.</p><p><code>CRef</code>s are represented as a unique numeric identifier and a
 reference containing (a) any thread-local non-synchronised writes
 (so each thread sees its latest write), (b) a commit count (used in
 compare-and-swaps), and (c) the current value visible to all
 threads.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:CRef" class="def">CRef</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a>, r (<a href="https://hackage.haskell.org/package/containers-0.5.6.2/docs/Data-IntMap-Strict.html#t:IntMap">IntMap</a> a, <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#t:Integer">Integer</a>, a))</td><td class="doc empty">&nbsp;</td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">newtype</span> <a name="t:Ticket" class="def">Ticket</a> a <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#Ticket" class="link">Source</a></p><div class="doc"><p>The compare-and-swap proof type.</p><p><code>Ticket</code>s are represented as just a wrapper around the identifier
 of the <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRef">CRef</a></code> it came from, the commit count at the time it was
 produced, and an <code>a</code> value. This doesn't work in the source package
 (atomic-primops) because of the need to use pointer equality. Here
 we can just pack extra information into <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRef">CRef</a></code> to avoid that need.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:Ticket" class="def">Ticket</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a>, <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Prelude.html#t:Integer">Integer</a>, a)</td><td class="doc empty">&nbsp;</td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:Fixed" class="def">Fixed</a> n r s = <a href="Test-DejaFu-Internal.html#t:Ref">Ref</a> n r (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:M">M</a> n r s) <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#Fixed" class="link">Source</a></p><div class="doc"><p>Dict of methods for implementations to override.</p></div></div><div class="top"><p class="src"><a name="v:cont" class="def">cont</a> :: ((a -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s) -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s) -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:M">M</a> n r s a <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#cont" class="link">Source</a></p><div class="doc"><p>Construct a continuation-passing operation from a function.</p></div></div><div class="top"><p class="src"><a name="v:runCont" class="def">runCont</a> :: <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:M">M</a> n r s a -&gt; (a -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s) -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#runCont" class="link">Source</a></p><div class="doc"><p>Run a CPS computation with the given final computation.</p></div></div><h1 id="g:2">Primitive Actions</h1><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:Action" class="def">Action</a> n r s <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#Action" class="link">Source</a></p><div class="doc"><p>Scheduling is done in terms of a trace of <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a></code>s. Blocking can
 only occur as a result of an action, and they cover (most of) the
 primitives of the concurrency. <code>spawn</code> is absent as it is
 implemented in terms of <code>newEmptyCVar</code>, <code>fork</code>, and <code>putCVar</code>.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:AFork" class="def">AFork</a> ((<span class="keyword">forall</span> b. <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:M">M</a> n r s b -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:M">M</a> n r s b) -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s) (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a> -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:AMyTId" class="def">AMyTId</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a> -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><span class="keyword">forall</span> a . <a name="v:ANewVar" class="def">ANewVar</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVar">CVar</a> r a -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><span class="keyword">forall</span> a . <a name="v:APutVar" class="def">APutVar</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVar">CVar</a> r a) a (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><span class="keyword">forall</span> a . <a name="v:ATryPutVar" class="def">ATryPutVar</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVar">CVar</a> r a) a (<a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Bool.html#t:Bool">Bool</a> -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><span class="keyword">forall</span> a . <a name="v:AReadVar" class="def">AReadVar</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVar">CVar</a> r a) (a -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><span class="keyword">forall</span> a . <a name="v:ATakeVar" class="def">ATakeVar</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVar">CVar</a> r a) (a -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><span class="keyword">forall</span> a . <a name="v:ATryTakeVar" class="def">ATryTakeVar</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVar">CVar</a> r a) (<a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Maybe.html#t:Maybe">Maybe</a> a -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><span class="keyword">forall</span> a . <a name="v:ANewRef" class="def">ANewRef</a> a (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRef">CRef</a> r a -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><span class="keyword">forall</span> a . <a name="v:AReadRef" class="def">AReadRef</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRef">CRef</a> r a) (a -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><span class="keyword">forall</span> a . <a name="v:AReadRefCas" class="def">AReadRefCas</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRef">CRef</a> r a) (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Ticket">Ticket</a> a -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><span class="keyword">forall</span> a . <a name="v:APeekTicket" class="def">APeekTicket</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Ticket">Ticket</a> a) (a -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><span class="keyword">forall</span> a b . <a name="v:AModRef" class="def">AModRef</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRef">CRef</a> r a) (a -&gt; (a, b)) (b -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><span class="keyword">forall</span> a b . <a name="v:AModRefCas" class="def">AModRefCas</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRef">CRef</a> r a) (a -&gt; (a, b)) (b -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><span class="keyword">forall</span> a . <a name="v:AWriteRef" class="def">AWriteRef</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRef">CRef</a> r a) a (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><span class="keyword">forall</span> a . <a name="v:ACasRef" class="def">ACasRef</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRef">CRef</a> r a) (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Ticket">Ticket</a> a) a ((<a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Bool.html#t:Bool">Bool</a>, <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Ticket">Ticket</a> a) -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><span class="keyword">forall</span> e . <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Exception-Base.html#t:Exception">Exception</a> e =&gt; <a name="v:AThrow" class="def">AThrow</a> e</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><span class="keyword">forall</span> e . <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Exception-Base.html#t:Exception">Exception</a> e =&gt; <a name="v:AThrowTo" class="def">AThrowTo</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a> e (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><span class="keyword">forall</span> a e . <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Exception-Base.html#t:Exception">Exception</a> e =&gt; <a name="v:ACatching" class="def">ACatching</a> (e -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:M">M</a> n r s a) (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:M">M</a> n r s a) (a -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:APopCatching" class="def">APopCatching</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><span class="keyword">forall</span> a . <a name="v:AMasking" class="def">AMasking</a> <a href="Test-DejaFu-Deterministic.html#t:MaskingState">MaskingState</a> ((<span class="keyword">forall</span> b. <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:M">M</a> n r s b -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:M">M</a> n r s b) -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:M">M</a> n r s a) (a -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:AResetMask" class="def">AResetMask</a> <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Bool.html#t:Bool">Bool</a> <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Bool.html#t:Bool">Bool</a> <a href="Test-DejaFu-Deterministic.html#t:MaskingState">MaskingState</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:AKnowsAbout" class="def">AKnowsAbout</a> (<a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Either.html#t:Either">Either</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a> <a href="Test-DejaFu-STM-Internal.html#t:CTVarId">CTVarId</a>) (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:AForgets" class="def">AForgets</a> (<a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Either.html#t:Either">Either</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a> <a href="Test-DejaFu-STM-Internal.html#t:CTVarId">CTVarId</a>) (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:AAllKnown" class="def">AAllKnown</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><span class="keyword">forall</span> a . <a name="v:AAtom" class="def">AAtom</a> (s a) (a -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:ALift" class="def">ALift</a> (n (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s))</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:AYield" class="def">AYield</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:AReturn" class="def">AReturn</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:ACommit" class="def">ACommit</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:AStop" class="def">AStop</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div><h1 id="g:3">Identifiers</h1><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:ThreadId" class="def">ThreadId</a> = <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Int.html#t:Int">Int</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#ThreadId" class="link">Source</a></p><div class="doc"><p>Every live thread has a unique identitifer.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:CVarId" class="def">CVarId</a> = <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Int.html#t:Int">Int</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#CVarId" class="link">Source</a></p><div class="doc"><p>Every <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVar">CVar</a></code> has a unique identifier.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:CRefId" class="def">CRefId</a> = <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Int.html#t:Int">Int</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#CRefId" class="link">Source</a></p><div class="doc"><p>Every <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRef">CRef</a></code> has a unique identifier.</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:IdSource" class="def">IdSource</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#IdSource" class="link">Source</a></p><div class="doc"><p>The number of ID parameters was getting a bit unwieldy, so this
 hides them all away.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:Id" class="def">Id</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:_nextCRId" class="def">_nextCRId</a> :: <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:_nextCVId" class="def">_nextCVId</a> :: <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a></dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:_nextCTVId" class="def">_nextCTVId</a> :: <a href="Test-DejaFu-STM-Internal.html#t:CTVarId">CTVarId</a></dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:_nextTId" class="def">_nextTId</a> :: <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a></dt><dd class="doc empty">&nbsp;</dd></dl><div class="clear"></div></div></td></tr></table></div></div><div class="top"><p class="src"><a name="v:nextCRId" class="def">nextCRId</a> :: <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:IdSource">IdSource</a> -&gt; (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:IdSource">IdSource</a>, <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a>) <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#nextCRId" class="link">Source</a></p><div class="doc"><p>Get the next free <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></code>.</p></div></div><div class="top"><p class="src"><a name="v:nextCVId" class="def">nextCVId</a> :: <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:IdSource">IdSource</a> -&gt; (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:IdSource">IdSource</a>, <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a>) <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#nextCVId" class="link">Source</a></p><div class="doc"><p>Get the next free <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a></code>.</p></div></div><div class="top"><p class="src"><a name="v:nextCTVId" class="def">nextCTVId</a> :: <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:IdSource">IdSource</a> -&gt; (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:IdSource">IdSource</a>, <a href="Test-DejaFu-STM-Internal.html#t:CTVarId">CTVarId</a>) <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#nextCTVId" class="link">Source</a></p><div class="doc"><p>Get the next free <code><a href="Test-DejaFu-STM-Internal.html#t:CTVarId">CTVarId</a></code>.</p></div></div><div class="top"><p class="src"><a name="v:nextTId" class="def">nextTId</a> :: <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:IdSource">IdSource</a> -&gt; (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:IdSource">IdSource</a>, <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a>) <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#nextTId" class="link">Source</a></p><div class="doc"><p>Get the next free <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a></code>.</p></div></div><div class="top"><p class="src"><a name="v:initialIdSource" class="def">initialIdSource</a> :: <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:IdSource">IdSource</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#initialIdSource" class="link">Source</a></p><div class="doc"><p>The initial ID source.</p></div></div><h1 id="g:4">Scheduling &amp; Traces</h1><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:Scheduler" class="def">Scheduler</a> s = s -&gt; <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Maybe.html#t:Maybe">Maybe</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a>, <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadAction">ThreadAction</a>) -&gt; <a href="Data-List-Extra.html#t:NonEmpty">NonEmpty</a> (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a>, <a href="Data-List-Extra.html#t:NonEmpty">NonEmpty</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Lookahead">Lookahead</a>) -&gt; (<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a>, s) <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#Scheduler" class="link">Source</a></p><div class="doc"><p>A <code>Scheduler</code> maintains some internal state, <code>s</code>, takes the
 <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a></code> of the last thread scheduled, or <code><a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Maybe.html#v:Nothing">Nothing</a></code> if this is
 the first decision, and the list of runnable threads along with
 what each will do in the next steps (as far as can be
 determined). It produces a <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a></code> to schedule, and a new state.</p><p><strong>Note:</strong> In order to prevent computation from hanging, the runtime
 will assume that a deadlock situation has arisen if the scheduler
 attempts to (a) schedule a blocked thread, or (b) schedule a
 nonexistent thread. In either of those cases, the computation will
 be halted.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:Trace" class="def">Trace</a> = [(<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Decision">Decision</a>, [(<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Decision">Decision</a>, <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Lookahead">Lookahead</a>)], <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadAction">ThreadAction</a>)] <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#Trace" class="link">Source</a></p><div class="doc"><p>One of the outputs of the runner is a <code>Trace</code>, which is a log of
 decisions made, alternative decisions (including what action would
 have been performed had that decision been taken), and the action a
 thread took in its step.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:Trace-39-" class="def">Trace'</a> = [(<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Decision">Decision</a>, [(<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Decision">Decision</a>, <a href="Data-List-Extra.html#t:NonEmpty">NonEmpty</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Lookahead">Lookahead</a>)], <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadAction">ThreadAction</a>)] <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#Trace%27" class="link">Source</a></p><div class="doc"><p>Like a <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Trace">Trace</a></code>, but gives more lookahead (where possible) for
 alternative decisions.</p></div></div><div class="top"><p class="src"><a name="v:toTrace" class="def">toTrace</a> :: <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Trace-39-">Trace'</a> -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Trace">Trace</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#toTrace" class="link">Source</a></p><div class="doc"><p>Throw away information from a <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Trace-39-">Trace'</a></code> to get just a <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Trace">Trace</a></code>.</p></div></div><div class="top"><p class="src"><a name="v:showTrace" class="def">showTrace</a> :: <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Trace">Trace</a> -&gt; <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-String.html#t:String">String</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#showTrace" class="link">Source</a></p><div class="doc"><p>Pretty-print a trace.</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:Decision" class="def">Decision</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#Decision" class="link">Source</a></p><div class="doc"><p>Scheduling decisions are based on the state of the running
 program, and so we can capture some of that state in recording what
 specific decision we made.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:Start" class="def">Start</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a></td><td class="doc"><p>Start a new thread, because the last was blocked (or it's the
 start of computation).</p></td></tr><tr><td class="src"><a name="v:Continue" class="def">Continue</a></td><td class="doc"><p>Continue running the last thread for another step.</p></td></tr><tr><td class="src"><a name="v:SwitchTo" class="def">SwitchTo</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a></td><td class="doc"><p>Pre-empt the running thread, and switch to another.</p></td></tr><tr><td class="src"><a name="v:Commit" class="def">Commit</a></td><td class="doc"><p>Commit a <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRef">CRef</a></code> write action so that every thread can see the
 result.</p></td></tr></table></div><div class="subs instances"><p id="control.i:Decision" class="caption collapser" onclick="toggleSection('i:Decision')">Instances</p><div id="section.i:Decision" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Eq.html#t:Eq">Eq</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Decision">Decision</a></span> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#line-219" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Text-Show.html#t:Show">Show</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Decision">Decision</a></span> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#line-219" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="https://hackage.haskell.org/package/deepseq-1.4.1.1/docs/Control-DeepSeq.html#t:NFData">NFData</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Decision">Decision</a></span> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#line-221" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:ThreadAction" class="def">ThreadAction</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#ThreadAction" class="link">Source</a></p><div class="doc"><p>All the actions that a thread can perform.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:Fork" class="def">Fork</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a></td><td class="doc"><p>Start a new thread.</p></td></tr><tr><td class="src"><a name="v:MyThreadId" class="def">MyThreadId</a></td><td class="doc"><p>Get the <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a></code> of the current thread.</p></td></tr><tr><td class="src"><a name="v:Yield" class="def">Yield</a></td><td class="doc"><p>Yield the current thread.</p></td></tr><tr><td class="src"><a name="v:NewVar" class="def">NewVar</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a></td><td class="doc"><p>Create a new <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVar">CVar</a></code>.</p></td></tr><tr><td class="src"><a name="v:PutVar" class="def">PutVar</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a> [<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a>]</td><td class="doc"><p>Put into a <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVar">CVar</a></code>, possibly waking up some threads.</p></td></tr><tr><td class="src"><a name="v:BlockedPutVar" class="def">BlockedPutVar</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a></td><td class="doc"><p>Get blocked on a put.</p></td></tr><tr><td class="src"><a name="v:TryPutVar" class="def">TryPutVar</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a> <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Bool.html#t:Bool">Bool</a> [<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a>]</td><td class="doc"><p>Try to put into a <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVar">CVar</a></code>, possibly waking up some threads.</p></td></tr><tr><td class="src"><a name="v:ReadVar" class="def">ReadVar</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a></td><td class="doc"><p>Read from a <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVar">CVar</a></code>.</p></td></tr><tr><td class="src"><a name="v:BlockedReadVar" class="def">BlockedReadVar</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a></td><td class="doc"><p>Get blocked on a read.</p></td></tr><tr><td class="src"><a name="v:TakeVar" class="def">TakeVar</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a> [<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a>]</td><td class="doc"><p>Take from a <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVar">CVar</a></code>, possibly waking up some threads.</p></td></tr><tr><td class="src"><a name="v:BlockedTakeVar" class="def">BlockedTakeVar</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a></td><td class="doc"><p>Get blocked on a take.</p></td></tr><tr><td class="src"><a name="v:TryTakeVar" class="def">TryTakeVar</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a> <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Bool.html#t:Bool">Bool</a> [<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a>]</td><td class="doc"><p>Try to take from a <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVar">CVar</a></code>, possibly waking up some threads.</p></td></tr><tr><td class="src"><a name="v:NewRef" class="def">NewRef</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></td><td class="doc"><p>Create a new <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRef">CRef</a></code>.</p></td></tr><tr><td class="src"><a name="v:ReadRef" class="def">ReadRef</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></td><td class="doc"><p>Read from a <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRef">CRef</a></code>.</p></td></tr><tr><td class="src"><a name="v:ReadRefCas" class="def">ReadRefCas</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></td><td class="doc"><p>Read from a <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRef">CRef</a></code> for a future compare-and-swap.</p></td></tr><tr><td class="src"><a name="v:PeekTicket" class="def">PeekTicket</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></td><td class="doc"><p>Extract the value from a <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Ticket">Ticket</a></code>.</p></td></tr><tr><td class="src"><a name="v:ModRef" class="def">ModRef</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></td><td class="doc"><p>Modify a <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRef">CRef</a></code>.</p></td></tr><tr><td class="src"><a name="v:ModRefCas" class="def">ModRefCas</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></td><td class="doc"><p>Modify a <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRef">CRef</a></code> using a compare-and-swap.</p></td></tr><tr><td class="src"><a name="v:WriteRef" class="def">WriteRef</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></td><td class="doc"><p>Write to a <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRef">CRef</a></code> without synchronising.</p></td></tr><tr><td class="src"><a name="v:CasRef" class="def">CasRef</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a> <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Bool.html#t:Bool">Bool</a></td><td class="doc"><p>Attempt to to a <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRef">CRef</a></code> using a compare-and-swap, synchronising
 it.</p></td></tr><tr><td class="src"><a name="v:CommitRef" class="def">CommitRef</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></td><td class="doc"><p>Commit the last write to the given <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRef">CRef</a></code> by the given thread,
 so that all threads can see the updated value.</p></td></tr><tr><td class="src"><a name="v:STM" class="def">STM</a> [<a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a>]</td><td class="doc"><p>An STM transaction was executed, possibly waking up some
 threads.</p></td></tr><tr><td class="src"><a name="v:FreshSTM" class="def">FreshSTM</a></td><td class="doc"><p>An STM transaction was executed, and all it did was create and
 write to new <code>CTVar</code>s, no existing <code>CTVar</code>s were touched.</p></td></tr><tr><td class="src"><a name="v:BlockedSTM" class="def">BlockedSTM</a></td><td class="doc"><p>Got blocked in an STM transaction.</p></td></tr><tr><td class="src"><a name="v:Catching" class="def">Catching</a></td><td class="doc"><p>Register a new exception handler</p></td></tr><tr><td class="src"><a name="v:PopCatching" class="def">PopCatching</a></td><td class="doc"><p>Pop the innermost exception handler from the stack.</p></td></tr><tr><td class="src"><a name="v:Throw" class="def">Throw</a></td><td class="doc"><p>Throw an exception.</p></td></tr><tr><td class="src"><a name="v:ThrowTo" class="def">ThrowTo</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a></td><td class="doc"><p>Throw an exception to a thread.</p></td></tr><tr><td class="src"><a name="v:BlockedThrowTo" class="def">BlockedThrowTo</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a></td><td class="doc"><p>Get blocked on a <code>throwTo</code>.</p></td></tr><tr><td class="src"><a name="v:Killed" class="def">Killed</a></td><td class="doc"><p>Killed by an uncaught exception.</p></td></tr><tr><td class="src"><a name="v:SetMasking" class="def">SetMasking</a> <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Bool.html#t:Bool">Bool</a> <a href="Test-DejaFu-Deterministic.html#t:MaskingState">MaskingState</a></td><td class="doc"><p>Set the masking state. If <code><a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Bool.html#v:True">True</a></code>, this is being used to set the
 masking state to the original state in the argument passed to a
 <code>mask</code>ed function.</p></td></tr><tr><td class="src"><a name="v:ResetMasking" class="def">ResetMasking</a> <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Bool.html#t:Bool">Bool</a> <a href="Test-DejaFu-Deterministic.html#t:MaskingState">MaskingState</a></td><td class="doc"><p>Return to an earlier masking state.  If <code><a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Bool.html#v:True">True</a></code>, this is being
 used to return to the state of the masked block in the argument
 passed to a <code>mask</code>ed function.</p></td></tr><tr><td class="src"><a name="v:Lift" class="def">Lift</a></td><td class="doc"><p>Lift an action from the underlying monad. Note that the
 penultimate action in a trace will always be a <code>Lift</code>, this is an
 artefact of how the runner works.</p></td></tr><tr><td class="src"><a name="v:Return" class="def">Return</a></td><td class="doc"><p>A <code><a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Monad.html#v:return">return</a></code> or <code><a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Applicative.html#v:pure">pure</a></code> action was executed.</p></td></tr><tr><td class="src"><a name="v:KnowsAbout" class="def">KnowsAbout</a></td><td class="doc"><p>A <code>_concKnowsAbout</code> annotation was processed.</p></td></tr><tr><td class="src"><a name="v:Forgets" class="def">Forgets</a></td><td class="doc"><p>A <code>_concForgets</code> annotation was processed.</p></td></tr><tr><td class="src"><a name="v:AllKnown" class="def">AllKnown</a></td><td class="doc"><p>A <code>_concALlKnown</code> annotation was processed.</p></td></tr><tr><td class="src"><a name="v:Stop" class="def">Stop</a></td><td class="doc"><p>Cease execution and terminate.</p></td></tr></table></div><div class="subs instances"><p id="control.i:ThreadAction" class="caption collapser" onclick="toggleSection('i:ThreadAction')">Instances</p><div id="section.i:ThreadAction" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Eq.html#t:Eq">Eq</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadAction">ThreadAction</a></span> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#line-314" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Text-Show.html#t:Show">Show</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadAction">ThreadAction</a></span> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#line-314" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="https://hackage.haskell.org/package/deepseq-1.4.1.1/docs/Control-DeepSeq.html#t:NFData">NFData</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadAction">ThreadAction</a></span> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#line-316" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:Lookahead" class="def">Lookahead</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#Lookahead" class="link">Source</a></p><div class="doc"><p>A one-step look-ahead at what a thread will do next.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:WillFork" class="def">WillFork</a></td><td class="doc"><p>Will start a new thread.</p></td></tr><tr><td class="src"><a name="v:WillMyThreadId" class="def">WillMyThreadId</a></td><td class="doc"><p>Will get the <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a></code>.</p></td></tr><tr><td class="src"><a name="v:WillYield" class="def">WillYield</a></td><td class="doc"><p>Will yield the current thread.</p></td></tr><tr><td class="src"><a name="v:WillNewVar" class="def">WillNewVar</a></td><td class="doc"><p>Will create a new <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVar">CVar</a></code>.</p></td></tr><tr><td class="src"><a name="v:WillPutVar" class="def">WillPutVar</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a></td><td class="doc"><p>Will put into a <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVar">CVar</a></code>, possibly waking up some threads.</p></td></tr><tr><td class="src"><a name="v:WillTryPutVar" class="def">WillTryPutVar</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a></td><td class="doc"><p>Will try to put into a <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVar">CVar</a></code>, possibly waking up some threads.</p></td></tr><tr><td class="src"><a name="v:WillReadVar" class="def">WillReadVar</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a></td><td class="doc"><p>Will read from a <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVar">CVar</a></code>.</p></td></tr><tr><td class="src"><a name="v:WillTakeVar" class="def">WillTakeVar</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a></td><td class="doc"><p>Will take from a <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVar">CVar</a></code>, possibly waking up some threads.</p></td></tr><tr><td class="src"><a name="v:WillTryTakeVar" class="def">WillTryTakeVar</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a></td><td class="doc"><p>Will try to take from a <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVar">CVar</a></code>, possibly waking up some threads.</p></td></tr><tr><td class="src"><a name="v:WillNewRef" class="def">WillNewRef</a></td><td class="doc"><p>Will create a new <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRef">CRef</a></code>.</p></td></tr><tr><td class="src"><a name="v:WillReadRef" class="def">WillReadRef</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></td><td class="doc"><p>Will read from a <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRef">CRef</a></code>.</p></td></tr><tr><td class="src"><a name="v:WillPeekTicket" class="def">WillPeekTicket</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></td><td class="doc"><p>Will extract the value from a <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Ticket">Ticket</a></code>.</p></td></tr><tr><td class="src"><a name="v:WillReadRefCas" class="def">WillReadRefCas</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></td><td class="doc"><p>Will read from a <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRef">CRef</a></code> for a future compare-and-swap.</p></td></tr><tr><td class="src"><a name="v:WillModRef" class="def">WillModRef</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></td><td class="doc"><p>Will modify a <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRef">CRef</a></code>.</p></td></tr><tr><td class="src"><a name="v:WillModRefCas" class="def">WillModRefCas</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></td><td class="doc"><p>Will nodify a <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRef">CRef</a></code> using a compare-and-swap.</p></td></tr><tr><td class="src"><a name="v:WillWriteRef" class="def">WillWriteRef</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></td><td class="doc"><p>Will write to a <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRef">CRef</a></code> without synchronising.</p></td></tr><tr><td class="src"><a name="v:WillCasRef" class="def">WillCasRef</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></td><td class="doc"><p>Will attempt to to a <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRef">CRef</a></code> using a compare-and-swap,
 synchronising it.</p></td></tr><tr><td class="src"><a name="v:WillCommitRef" class="def">WillCommitRef</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></td><td class="doc"><p>Will commit the last write by the given thread to the <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRef">CRef</a></code>.</p></td></tr><tr><td class="src"><a name="v:WillSTM" class="def">WillSTM</a></td><td class="doc"><p>Will execute an STM transaction, possibly waking up some
 threads.</p></td></tr><tr><td class="src"><a name="v:WillCatching" class="def">WillCatching</a></td><td class="doc"><p>Will register a new exception handler</p></td></tr><tr><td class="src"><a name="v:WillPopCatching" class="def">WillPopCatching</a></td><td class="doc"><p>Will pop the innermost exception handler from the stack.</p></td></tr><tr><td class="src"><a name="v:WillThrow" class="def">WillThrow</a></td><td class="doc"><p>Will throw an exception.</p></td></tr><tr><td class="src"><a name="v:WillThrowTo" class="def">WillThrowTo</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadId">ThreadId</a></td><td class="doc"><p>Will throw an exception to a thread.</p></td></tr><tr><td class="src"><a name="v:WillSetMasking" class="def">WillSetMasking</a> <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Bool.html#t:Bool">Bool</a> <a href="Test-DejaFu-Deterministic.html#t:MaskingState">MaskingState</a></td><td class="doc"><p>Will set the masking state. If <code><a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Bool.html#v:True">True</a></code>, this is being used to
 set the masking state to the original state in the argument
 passed to a <code>mask</code>ed function.</p></td></tr><tr><td class="src"><a name="v:WillResetMasking" class="def">WillResetMasking</a> <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Bool.html#t:Bool">Bool</a> <a href="Test-DejaFu-Deterministic.html#t:MaskingState">MaskingState</a></td><td class="doc"><p>Will return to an earlier masking state.  If <code><a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Bool.html#v:True">True</a></code>, this is
 being used to return to the state of the masked block in the
 argument passed to a <code>mask</code>ed function.</p></td></tr><tr><td class="src"><a name="v:WillLift" class="def">WillLift</a></td><td class="doc"><p>Will lift an action from the underlying monad. Note that the
 penultimate action in a trace will always be a <code>Lift</code>, this is an
 artefact of how the runner works.</p></td></tr><tr><td class="src"><a name="v:WillReturn" class="def">WillReturn</a></td><td class="doc"><p>Will execute a <code><a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Monad.html#v:return">return</a></code> or <code><a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Applicative.html#v:pure">pure</a></code> action.</p></td></tr><tr><td class="src"><a name="v:WillKnowsAbout" class="def">WillKnowsAbout</a></td><td class="doc"><p>Will process a <code>_concKnowsAbout</code> annotation.</p></td></tr><tr><td class="src"><a name="v:WillForgets" class="def">WillForgets</a></td><td class="doc"><p>Will process a <code>_concForgets</code> annotation.</p></td></tr><tr><td class="src"><a name="v:WillAllKnown" class="def">WillAllKnown</a></td><td class="doc"><p>Will process a <code>_concALlKnown</code> annotation.</p></td></tr><tr><td class="src"><a name="v:WillStop" class="def">WillStop</a></td><td class="doc"><p>Will cease execution and terminate.</p></td></tr></table></div><div class="subs instances"><p id="control.i:Lookahead" class="caption collapser" onclick="toggleSection('i:Lookahead')">Instances</p><div id="section.i:Lookahead" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Eq.html#t:Eq">Eq</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Lookahead">Lookahead</a></span> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#line-415" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Text-Show.html#t:Show">Show</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Lookahead">Lookahead</a></span> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#line-415" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="https://hackage.haskell.org/package/deepseq-1.4.1.1/docs/Control-DeepSeq.html#t:NFData">NFData</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Lookahead">Lookahead</a></span> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#line-417" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><a name="v:lookahead" class="def">lookahead</a> :: <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Action">Action</a> n r s -&gt; <a href="Data-List-Extra.html#t:NonEmpty">NonEmpty</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Lookahead">Lookahead</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#lookahead" class="link">Source</a></p><div class="doc"><p>Look as far ahead in the given continuation as possible.</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:ActionType" class="def">ActionType</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#ActionType" class="link">Source</a></p><div class="doc"><p>A simplified view of the possible actions a thread can perform.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:UnsynchronisedRead" class="def">UnsynchronisedRead</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></td><td class="doc"><p>A <code>readCRef</code> or a <code>readForCAS</code>.</p></td></tr><tr><td class="src"><a name="v:UnsynchronisedWrite" class="def">UnsynchronisedWrite</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></td><td class="doc"><p>A <code>writeCRef</code>.</p></td></tr><tr><td class="src"><a name="v:UnsynchronisedOther" class="def">UnsynchronisedOther</a></td><td class="doc"><p>Some other action which doesn't require cross-thread
 communication.</p></td></tr><tr><td class="src"><a name="v:PartiallySynchronisedCommit" class="def">PartiallySynchronisedCommit</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></td><td class="doc"><p>A commit.</p></td></tr><tr><td class="src"><a name="v:PartiallySynchronisedWrite" class="def">PartiallySynchronisedWrite</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></td><td class="doc"><p>A <code>casCRef</code></p></td></tr><tr><td class="src"><a name="v:PartiallySynchronisedModify" class="def">PartiallySynchronisedModify</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></td><td class="doc"><p>A <code>modifyCRefCAS</code></p></td></tr><tr><td class="src"><a name="v:SynchronisedModify" class="def">SynchronisedModify</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a></td><td class="doc"><p>An <code>atomicModifyCRef</code>.</p></td></tr><tr><td class="src"><a name="v:SynchronisedRead" class="def">SynchronisedRead</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a></td><td class="doc"><p>A <code>readCVar</code> or <code>takeCVar</code> (or <code>try</code>/<code>blocked</code> variants).</p></td></tr><tr><td class="src"><a name="v:SynchronisedWrite" class="def">SynchronisedWrite</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a></td><td class="doc"><p>A <code>putCVar</code> (or <code>try</code>/<code>blocked</code> variant).</p></td></tr><tr><td class="src"><a name="v:SynchronisedOther" class="def">SynchronisedOther</a></td><td class="doc"><p>Some other action which does require cross-thread
 communication.</p></td></tr></table></div><div class="subs instances"><p id="control.i:ActionType" class="caption collapser" onclick="toggleSection('i:ActionType')">Instances</p><div id="section.i:ActionType" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Eq.html#t:Eq">Eq</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ActionType">ActionType</a></span> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#line-495" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Text-Show.html#t:Show">Show</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ActionType">ActionType</a></span> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#line-495" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="https://hackage.haskell.org/package/deepseq-1.4.1.1/docs/Control-DeepSeq.html#t:NFData">NFData</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ActionType">ActionType</a></span> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#line-497" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><a name="v:isBarrier" class="def">isBarrier</a> :: <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ActionType">ActionType</a> -&gt; <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Bool.html#t:Bool">Bool</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#isBarrier" class="link">Source</a></p><div class="doc"><p>Check if an action imposes a write barrier.</p></div></div><div class="top"><p class="src"><a name="v:synchronises" class="def">synchronises</a> :: <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ActionType">ActionType</a> -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a> -&gt; <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Bool.html#t:Bool">Bool</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#synchronises" class="link">Source</a></p><div class="doc"><p>Check if an action is synchronises a given <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRef">CRef</a></code>.</p></div></div><div class="top"><p class="src"><a name="v:crefOf" class="def">crefOf</a> :: <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ActionType">ActionType</a> -&gt; <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRefId">CRefId</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#crefOf" class="link">Source</a></p><div class="doc"><p>Get the <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRef">CRef</a></code> affected.</p></div></div><div class="top"><p class="src"><a name="v:cvarOf" class="def">cvarOf</a> :: <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ActionType">ActionType</a> -&gt; <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVarId">CVarId</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#cvarOf" class="link">Source</a></p><div class="doc"><p>Get the <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVar">CVar</a></code> affected.</p></div></div><div class="top"><p class="src"><a name="v:simplify" class="def">simplify</a> :: <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadAction">ThreadAction</a> -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ActionType">ActionType</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#simplify" class="link">Source</a></p><div class="doc"><p>Throw away information from a <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ThreadAction">ThreadAction</a></code> and give a
 simplified view of what is happening.</p><p>This is used in the SCT code to help determine interesting
 alternative scheduling decisions.</p></div></div><div class="top"><p class="src"><a name="v:simplify-39-" class="def">simplify'</a> :: <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Lookahead">Lookahead</a> -&gt; <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:ActionType">ActionType</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#simplify%27" class="link">Source</a></p><div class="doc"><p>Variant of <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#v:simplify">simplify</a></code> that takes a <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Lookahead">Lookahead</a></code>.</p></div></div><h1 id="g:5">Failures</h1><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:Failure" class="def">Failure</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#Failure" class="link">Source</a></p><div class="doc"><p>An indication of how a concurrent computation failed.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:InternalError" class="def">InternalError</a></td><td class="doc"><p>Will be raised if the scheduler does something bad. This should
 never arise unless you write your own, faulty, scheduler! If it
 does, please file a bug report.</p></td></tr><tr><td class="src"><a name="v:Deadlock" class="def">Deadlock</a></td><td class="doc"><p>The computation became blocked indefinitely on <code>CVar</code>s.</p></td></tr><tr><td class="src"><a name="v:STMDeadlock" class="def">STMDeadlock</a></td><td class="doc"><p>The computation became blocked indefinitely on <code>CTVar</code>s.</p></td></tr><tr><td class="src"><a name="v:UncaughtException" class="def">UncaughtException</a></td><td class="doc"><p>An uncaught exception bubbled to the top of the computation.</p></td></tr></table></div><div class="subs instances"><p id="control.i:Failure" class="caption collapser" onclick="toggleSection('i:Failure')">Instances</p><div id="section.i:Failure" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Eq.html#t:Eq">Eq</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Failure">Failure</a></span> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#line-599" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Text-Show.html#t:Show">Show</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Failure">Failure</a></span> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#line-599" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="https://hackage.haskell.org/package/deepseq-1.4.1.1/docs/Control-DeepSeq.html#t:NFData">NFData</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Failure">Failure</a></span> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#line-601" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><a name="v:showFail" class="def">showFail</a> :: <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:Failure">Failure</a> -&gt; <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-String.html#t:String">String</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#showFail" class="link">Source</a></p><div class="doc"><p>Pretty-print a failure</p></div></div><h1 id="g:6">Memory Models</h1><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:MemType" class="def">MemType</a> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#MemType" class="link">Source</a></p><div class="doc"><p>The memory model to use for non-synchronised <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRef">CRef</a></code> operations.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:SequentialConsistency" class="def">SequentialConsistency</a></td><td class="doc"><p>The most intuitive model: a program behaves as a simple
 interleaving of the actions in different threads. When a <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRef">CRef</a></code>
 is written to, that write is immediately visible to all threads.</p></td></tr><tr><td class="src"><a name="v:TotalStoreOrder" class="def">TotalStoreOrder</a></td><td class="doc"><p>Each thread has a write buffer. A thread sees its writes
 immediately, but other threads will only see writes when they are
 committed, which may happen later. Writes are committed in the
 same order that they are created.</p></td></tr><tr><td class="src"><a name="v:PartialStoreOrder" class="def">PartialStoreOrder</a></td><td class="doc"><p>Each <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRef">CRef</a></code> has a write buffer. A thread sees its writes
 immediately, but other threads will only see writes when they are
 committed, which may happen later. Writes to different <code><a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRef">CRef</a></code>s
 are not necessarily committed in the same order that they are
 created.</p></td></tr></table></div><div class="subs instances"><p id="control.i:MemType" class="caption collapser" onclick="toggleSection('i:MemType')">Instances</p><div id="section.i:MemType" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Eq.html#t:Eq">Eq</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:MemType">MemType</a></span> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#line-631" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Text-Read.html#t:Read">Read</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:MemType">MemType</a></span> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#line-631" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Text-Show.html#t:Show">Show</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:MemType">MemType</a></span> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#line-631" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="https://hackage.haskell.org/package/deepseq-1.4.1.1/docs/Control-DeepSeq.html#t:NFData">NFData</a> <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:MemType">MemType</a></span> <a href="src/Test-DejaFu-Deterministic-Internal-Common.html#line-633" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.16.1</p></div></body></html>