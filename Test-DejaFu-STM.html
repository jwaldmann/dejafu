<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Test.DejaFu.STM</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Test-DejaFu-STM.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Test-DejaFu-STM.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">dejafu-0.2.0.0: Overloadable primitives for testable, potentially non-deterministic, concurrency.</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Test.DejaFu.STM</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">The <code>STMLike</code> Monad</a></li><li><a href="#g:2">Executing Transactions</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>A <code>MonadSTM</code> implementation, which can be run on top of <code><a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/System-IO.html#t:IO">IO</a></code> or
 <code><a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Monad-ST.html#t:ST">ST</a></code>.</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">data</span> <a href="#t:STMLike">STMLike</a> n r a</li><li class="src short"><span class="keyword">type</span> <a href="#t:STMST">STMST</a> t = <a href="Test-DejaFu-STM.html#t:STMLike">STMLike</a> (<a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Monad-ST.html#t:ST">ST</a> t) (<a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-STRef.html#t:STRef">STRef</a> t)</li><li class="src short"><span class="keyword">type</span> <a href="#t:STMIO">STMIO</a> = <a href="Test-DejaFu-STM.html#t:STMLike">STMLike</a> <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/System-IO.html#t:IO">IO</a> <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-IORef.html#t:IORef">IORef</a></li><li class="src short"><span class="keyword">data</span> <a href="#t:Result">Result</a> a<ul class="subs"><li>= <a href="#v:Success">Success</a> [<a href="Test-DejaFu-STM.html#t:CTVarId">CTVarId</a>] [<a href="Test-DejaFu-STM.html#t:CTVarId">CTVarId</a>] a</li><li>| <a href="#v:Retry">Retry</a> [<a href="Test-DejaFu-STM.html#t:CTVarId">CTVarId</a>]</li><li>| <a href="#v:Exception">Exception</a> <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Exception-Base.html#t:SomeException">SomeException</a></li></ul></li><li class="src short"><span class="keyword">type</span> <a href="#t:CTVarId">CTVarId</a> = <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Int.html#t:Int">Int</a></li><li class="src short"><a href="#v:runTransactionST">runTransactionST</a> :: <a href="Test-DejaFu-STM.html#t:STMST">STMST</a> t a -&gt; <a href="Test-DejaFu-STM.html#t:CTVarId">CTVarId</a> -&gt; <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Monad-ST.html#t:ST">ST</a> t (<a href="Test-DejaFu-STM.html#t:Result">Result</a> a, <a href="Test-DejaFu-STM.html#t:CTVarId">CTVarId</a>)</li><li class="src short"><a href="#v:runTransactionIO">runTransactionIO</a> :: <a href="Test-DejaFu-STM.html#t:STMIO">STMIO</a> a -&gt; <a href="Test-DejaFu-STM.html#t:CTVarId">CTVarId</a> -&gt; <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/System-IO.html#t:IO">IO</a> (<a href="Test-DejaFu-STM.html#t:Result">Result</a> a, <a href="Test-DejaFu-STM.html#t:CTVarId">CTVarId</a>)</li></ul></div><div id="interface"><h1 id="g:1">The <code>STMLike</code> Monad</h1><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:STMLike" class="def">STMLike</a> n r a <a href="src/Test-DejaFu-STM.html#STMLike" class="link">Source</a></p><div class="subs instances"><p id="control.i:STMLike" class="caption collapser" onclick="toggleSection('i:STMLike')">Instances</p><div id="section.i:STMLike" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><a href="https://hackage.haskell.org/package/transformers-0.4.2.0/docs/Control-Monad-IO-Class.html#t:MonadIO">MonadIO</a> <a href="Test-DejaFu-Deterministic.html#t:ConcIO">ConcIO</a></span></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Monad.html#t:Monad">Monad</a> (<a href="Test-DejaFu-STM.html#t:STMLike">STMLike</a> n r)</span> <a href="src/Test-DejaFu-STM.html#line-38" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Functor.html#t:Functor">Functor</a> (<a href="Test-DejaFu-STM.html#t:STMLike">STMLike</a> n r)</span> <a href="src/Test-DejaFu-STM.html#line-38" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Applicative.html#t:Applicative">Applicative</a> (<a href="Test-DejaFu-STM.html#t:STMLike">STMLike</a> n r)</span> <a href="src/Test-DejaFu-STM.html#line-38" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left">MonadThrow (<a href="Test-DejaFu-STM.html#t:STMLike">STMLike</a> n r)</span> <a href="src/Test-DejaFu-STM.html#line-60" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left">MonadCatch (<a href="Test-DejaFu-STM.html#t:STMLike">STMLike</a> n r)</span> <a href="src/Test-DejaFu-STM.html#line-63" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Monad.html#t:Monad">Monad</a> n =&gt; <a href="Control-Monad-STM-Class.html#t:MonadSTM">MonadSTM</a> (<a href="Test-DejaFu-STM.html#t:STMLike">STMLike</a> n r)</span> <a href="src/Test-DejaFu-STM.html#line-66" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Monad.html#t:Monad">Monad</a> n =&gt; <a href="Control-Monad-Conc-Class.html#t:MonadConc">MonadConc</a> (<a href="Test-DejaFu-Deterministic.html#t:Conc">Conc</a> n r (<a href="Test-DejaFu-STM.html#t:STMLike">STMLike</a> n r))</span> <a href="src/Control-Monad-Conc-Class.html#line-93" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="keyword">type</span> <a href="Control-Monad-STM-Class.html#t:CTVar">CTVar</a> (<a href="Test-DejaFu-STM.html#t:STMLike">STMLike</a> n r) = <a href="Test-DejaFu-STM-Internal.html#t:CTVar">CTVar</a> r</span> <a href="src/Test-DejaFu-STM.html#line-67" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="keyword">type</span> <a href="Control-Monad-Conc-Class.html#t:STMLike">STMLike</a> (<a href="Test-DejaFu-Deterministic.html#t:Conc">Conc</a> n r (<a href="Test-DejaFu-STM.html#t:STMLike">STMLike</a> n r)) = <a href="Test-DejaFu-STM.html#t:STMLike">STMLike</a> n r</span> <a href="src/Control-Monad-Conc-Class.html#line-96" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="keyword">type</span> <a href="Control-Monad-Conc-Class.html#t:CVar">CVar</a> (<a href="Test-DejaFu-Deterministic.html#t:Conc">Conc</a> n r (<a href="Test-DejaFu-STM.html#t:STMLike">STMLike</a> n r)) = <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CVar">CVar</a> r</span> <a href="src/Control-Monad-Conc-Class.html#line-94" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="keyword">type</span> <a href="Control-Monad-Conc-Class.html#t:CRef">CRef</a> (<a href="Test-DejaFu-Deterministic.html#t:Conc">Conc</a> n r (<a href="Test-DejaFu-STM.html#t:STMLike">STMLike</a> n r)) = <a href="Test-DejaFu-Deterministic-Internal-Common.html#t:CRef">CRef</a> r</span> <a href="src/Control-Monad-Conc-Class.html#line-95" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="keyword">type</span> <a href="Control-Monad-Conc-Class.html#t:ThreadId">ThreadId</a> (<a href="Test-DejaFu-Deterministic.html#t:Conc">Conc</a> n r (<a href="Test-DejaFu-STM.html#t:STMLike">STMLike</a> n r)) = <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Int.html#t:Int">Int</a></span> <a href="src/Control-Monad-Conc-Class.html#line-97" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:STMST" class="def">STMST</a> t = <a href="Test-DejaFu-STM.html#t:STMLike">STMLike</a> (<a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Monad-ST.html#t:ST">ST</a> t) (<a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-STRef.html#t:STRef">STRef</a> t) <a href="src/Test-DejaFu-STM.html#STMST" class="link">Source</a></p><div class="doc"><p>A <code>MonadSTM</code> implementation using <code>ST</code>, it encapsulates a single
 atomic transaction. The environment, that is, the collection of
 defined <code><a href="Test-DejaFu-STM-Internal.html#t:CTVar">CTVar</a></code>s is implicit, there is no list of them, they exist
 purely as references. This makes the types simpler, but means you
 can't really get an aggregate of them (if you ever wanted to for
 some reason).</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:STMIO" class="def">STMIO</a> = <a href="Test-DejaFu-STM.html#t:STMLike">STMLike</a> <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/System-IO.html#t:IO">IO</a> <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-IORef.html#t:IORef">IORef</a> <a href="src/Test-DejaFu-STM.html#STMIO" class="link">Source</a></p><div class="doc"><p>A <code>MonadSTM</code> implementation using <code>ST</code>, it encapsulates a single
 atomic transaction. The environment, that is, the collection of
 defined <code><a href="Test-DejaFu-STM-Internal.html#t:CTVar">CTVar</a></code>s is implicit, there is no list of them, they exist
 purely as references. This makes the types simpler, but means you
 can't really get an aggregate of them (if you ever wanted to for
 some reason).</p></div></div><h1 id="g:2">Executing Transactions</h1><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:Result" class="def">Result</a> a <a href="src/Test-DejaFu-STM-Internal.html#Result" class="link">Source</a></p><div class="doc"><p>The result of an STM transaction, along with which <code><a href="Test-DejaFu-STM-Internal.html#t:CTVar">CTVar</a></code>s it
 touched whilst executing.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:Success" class="def">Success</a> [<a href="Test-DejaFu-STM.html#t:CTVarId">CTVarId</a>] [<a href="Test-DejaFu-STM.html#t:CTVarId">CTVarId</a>] a</td><td class="doc"><p>The transaction completed successfully, reading the first list
 <code><a href="Test-DejaFu-STM-Internal.html#t:CTVar">CTVar</a></code>s and writing to the second.</p></td></tr><tr><td class="src"><a name="v:Retry" class="def">Retry</a> [<a href="Test-DejaFu-STM.html#t:CTVarId">CTVarId</a>]</td><td class="doc"><p>The transaction aborted by calling <code>retry</code>, and read the
 returned <code><a href="Test-DejaFu-STM-Internal.html#t:CTVar">CTVar</a></code>s. It should be retried when at least one of the
 <code><a href="Test-DejaFu-STM-Internal.html#t:CTVar">CTVar</a></code>s has been mutated.</p></td></tr><tr><td class="src"><a name="v:Exception" class="def">Exception</a> <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Exception-Base.html#t:SomeException">SomeException</a></td><td class="doc"><p>The transaction aborted by throwing an exception.</p></td></tr></table></div><div class="subs instances"><p id="control.i:Result" class="caption collapser" onclick="toggleSection('i:Result')">Instances</p><div id="section.i:Result" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Functor.html#t:Functor">Functor</a> <a href="Test-DejaFu-STM.html#t:Result">Result</a></span> <a href="src/Test-DejaFu-STM-Internal.html#line-77" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Foldable.html#t:Foldable">Foldable</a> <a href="Test-DejaFu-STM.html#t:Result">Result</a></span> <a href="src/Test-DejaFu-STM-Internal.html#line-82" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Text-Show.html#t:Show">Show</a> a =&gt; <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Text-Show.html#t:Show">Show</a> (<a href="Test-DejaFu-STM.html#t:Result">Result</a> a)</span> <a href="src/Test-DejaFu-STM-Internal.html#line-75" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:CTVarId" class="def">CTVarId</a> = <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Data-Int.html#t:Int">Int</a> <a href="src/Test-DejaFu-STM-Internal.html#CTVarId" class="link">Source</a></p><div class="doc"><p>The unique ID of a <code><a href="Test-DejaFu-STM-Internal.html#t:CTVar">CTVar</a></code>. Only meaningful within a single
 concurrent computation.</p></div></div><div class="top"><p class="src"><a name="v:runTransactionST" class="def">runTransactionST</a> :: <a href="Test-DejaFu-STM.html#t:STMST">STMST</a> t a -&gt; <a href="Test-DejaFu-STM.html#t:CTVarId">CTVarId</a> -&gt; <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Monad-ST.html#t:ST">ST</a> t (<a href="Test-DejaFu-STM.html#t:Result">Result</a> a, <a href="Test-DejaFu-STM.html#t:CTVarId">CTVarId</a>) <a href="src/Test-DejaFu-STM.html#runTransactionST" class="link">Source</a></p><div class="doc"><p>Run a transaction in the <code><a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/Control-Monad-ST.html#t:ST">ST</a></code> monad, returning the result and new
 initial <code><a href="Test-DejaFu-STM.html#t:CTVarId">CTVarId</a></code>. If the transaction ended by calling <code>retry</code>, any
 <code><a href="Test-DejaFu-STM-Internal.html#t:CTVar">CTVar</a></code> modifications are undone.</p></div></div><div class="top"><p class="src"><a name="v:runTransactionIO" class="def">runTransactionIO</a> :: <a href="Test-DejaFu-STM.html#t:STMIO">STMIO</a> a -&gt; <a href="Test-DejaFu-STM.html#t:CTVarId">CTVarId</a> -&gt; <a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/System-IO.html#t:IO">IO</a> (<a href="Test-DejaFu-STM.html#t:Result">Result</a> a, <a href="Test-DejaFu-STM.html#t:CTVarId">CTVarId</a>) <a href="src/Test-DejaFu-STM.html#runTransactionIO" class="link">Source</a></p><div class="doc"><p>Run a transaction in the <code><a href="https://hackage.haskell.org/package/base-4.8.1.0/docs/System-IO.html#t:IO">IO</a></code> monad, returning the result and new
 initial <code><a href="Test-DejaFu-STM.html#t:CTVarId">CTVarId</a></code>. If the transaction ended by calling <code>retry</code>, any
 <code><a href="Test-DejaFu-STM-Internal.html#t:CTVar">CTVar</a></code> modifications are undone.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.16.1</p></div></body></html>